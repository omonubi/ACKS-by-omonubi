<div class='pc'>
<!-- RegEx for debugging
    /\*(.*\)\1;)\*/
    /**/$1
    -----
    /\*\*/(.*\)\1;)
    /*$1*/
-->
<!-- Tab Controls -->
<div class='page-title'>
    <h1>Adventurer Conqueror King System</h1>
</div>
<div class='button-panel'>
    <input type='hidden' class='buttonstoggle' name='attr_sheetButtons' value='overview'/>
    <button type='action' class='btnOverview' name='act_overview' >Overview</button> 
    <button type='action' class='btnClass' name='act_class' >Class</button>
    <button type='action' class='btnSkills' name='act_skills' >Skills</button>
    <button type='action' class='btnCombat' name='act_combat' >Combat</button>    
    <button type='action' class='btnEquipment' name='act_equipment' >Equipment</button>   
    <button type='action' class='btnHirelings' name='act_hirelings' >Hirelings</button>
    <button type='action' class='btnJournal' name='act_journal' >Journal</button>
    <div class='whispertoggle'><label>Whisper Toggle: </label><input type='checkbox' name='attr_toggle_whisper' /><input type='hidden' name='attr_whispertoggle'/></div>
</div>

<input type='hidden' class='tabstoggle' name='attr_sheetTab' value='overview'/>
<!-- Character Sheet -->
<div class='overview'>
    <div class='grid11'>
        <div class='grid11'>
            <label>Character Name</label>
                <input type='text' name='attr_character_fullname' />
            <label>Class</label> 
                <input type='text' name='attr_class'/>
            <label>Title</label>
                <input type='text' name='attr_character_title'/>
            <label>Alignment</label>
                <input type='text' name='attr_alignment'/>
            <div><label class='xp'>Experience (+</label><span class='xpbonus' name='attr_xp_bonus'>0</span><label>%)</label></div>
                <div>
                    <input class='xp' type='text' value='0' name='attr_xp'/>
                    <input class='xp' type='text' value='0' name='attr_xp_next_level'/>
                </div>
            <label>Level</label>
                <input type='number' min='0' max='14' value='1' name='attr_level' />
                <input type='hidden' name='attr_max_level'/>
        </div>
        <div class='grid11'>
            <label>Token Name</label>
                <input type='text' name='attr_character_name' />
            <label>Gender</label>
                <input type='text' name='attr_gender'/>       
            <label>Height</label>
                <input type='text' name='attr_height'/>
            <label>Weight</label>
                <input type='text' name='attr_weight'/>
            <label>Age</label>
                <input type='number' name='attr_age' />
            <label>Fate</label>
                <input type='number' value='3' name='attr_fate' />
        </div>
    </div>
    <hr/>
    <div class='grid11'>        
        <div class='grid11111'>
            <label class='spanheader'>Attributes</label>
            <label></label>
            <label>Current</label>
            <label>Nominal</label>
            <label>Mod</label>
            <label>Prereq</label>
            <button class='attribute' type='roll' value='@{whispertoggle} &{template:custom} {{title=@{banner_str} **@{character_title} @{selected|token_name}**}} {{subtitle=Strength Throw}} {{Target=[[@{str}]]}} {{Roll=[[1d20[die]+?{Modifier|0}[mod]]]}}' name='roll_str_check'> STR</button> 
            <input type='number' value='10' min='0' max='20' name='attr_str' />
            <input type='number' value='10' name='attr_str_max'readonly/>
            <input type='number' value='0' name='attr_str_mod' readonly />
            <input type='checkbox' name='attr_str_pre'/>
            <button class='attribute' type='roll' value='@{whispertoggle} &{template:custom} {{title=@{banner_int} **@{character_title} @{selected|token_name}**}} {{subtitle=Intelligence Throw}} {{Target=[[@{int}]]}} {{Roll=[[1d20[die]+?{Modifier|0}[mod]]]}}' name='roll_int_check'> INT</button>
            <input type='number' value='10' min='0' max='20' name='attr_int' />
            <input type='number' value='10' name='attr_int_max'readonly/>
            <input type='number' value='0' name='attr_int_mod' readonly />
            <input type='checkbox' name='attr_int_pre'/>
            <button class='attribute' type='roll' value='@{whispertoggle} &{template:custom} {{title=@{banner_wis} **@{character_title} @{selected|token_name}**}} {{subtitle=Wisdom Throw}} {{Target=[[@{wis}]]}} {{Roll=[[1d20[die]+?{Modifier|0}[mod]]]}}' name='roll_wis_check'> WIS</button>
            <input type='number' value='10' min='0' max='20' name='attr_wis' />
            <input type='number' value='10' name='attr_wis_max'readonly/>
            <input type='number' value='0' name='attr_wis_mod' readonly />
            <input type='checkbox' name='attr_wis_pre'/>
            <button class='attribute' type='roll' value='@{whispertoggle} &{template:custom} {{title=@{banner_dex} **@{character_title} @{selected|token_name}**}} {{subtitle=Dexterity Throw}} {{Target=[[@{dex}]]}} {{Roll=[[1d20[die]+?{Modifier|0}[mod]]]}}' name='roll_dex_check'> DEX</button>
            <input type='number' value='10' min='0' max='20' name='attr_dex' />
            <input type='number' value='10' name='attr_dex_max'readonly/>
            <input type='number' value='0' name='attr_dex_mod' readonly />
            <input type='checkbox' name='attr_dex_pre'/>
            <button class='attribute' type='roll' value='@{whispertoggle} &{template:custom} {{title=@{banner_con} **@{character_title} @{selected|token_name}**}} {{subtitle=Constitution Throw}} {{Target=[[@{con}]]}} {{Roll=[[1d20[die]+?{Modifier|0}[mod]]]}}' name='roll_con_check'> CON</button>
            <input type='number' value='10' min='0' max='20' name='attr_con' />
            <input type='number' value='10' name='attr_con_max'readonly/>
            <input type='number' value='0' name='attr_con_mod' readonly />
            <input type='checkbox' name='attr_con_pre'/>
            <button class='attribute' type='roll' value='@{whispertoggle} &{template:custom} {{title=@{banner_cha} **@{character_title} @{selected|token_name}**}} {{subtitle=Charisma Throw}} {{Target=[[@{cha}]]}} {{Roll=[[1d20[die]+?{Modifier|0}[mod]]]}}' name='roll_cha_check'> CHA</button>
            <input type='number' value='10' min='0' max='20' name='attr_cha' />
            <input type='number' value='10' name='attr_cha_max'readonly/>
            <input type='number' value='0' name='attr_cha_mod' readonly />
            <input type='checkbox' name='attr_chr_pre'/>
        </div>
        <div class='grid1111'>
            <label class='spanheader'>Additional Stats</label>
            <button type='roll' value='@{whispertoggle} &{template:custom} {{title=@{banner_hd} **@{character_title} @{selected|token_name}**}} {{color=green}} {{subtitle=Hit Dice Roll}} {{Hit Dice=@{hit_dice}}} {{Roll=[[@{hit_dice}]]}}' name='roll_hit_dice'> Hit Dice</button>
                <input class='width45' type='text' name='attr_hit_dice' />
                <input type='hidden' name='attr_hit_die'/>
            <button type='roll' value='@{whispertoggle} &{template:custom} {{title=@{banner_bhr} **@{character_title} @{selected|token_name}**}} {{color=green}} {{subtitle=Rest / Healing}} {{Base Healing Rate=@{bhr}}} {{Roll=[[@{bhr}]]}}' name='roll_base_healing_rate'> Heal BHR</button>
                <input class='width45' type='text' value='1d2' name='attr_bhr' readonly/>
                <input type='hidden' name='attr_temp_hd'/>
            <label>Hit Points</label>
                <input type='hidden' class='hpcheck' name='attr_hp_is_below_one'/>
                <input class='redhp' type='number' value='1' name='attr_hp'/> 
            <label>HP Max</label>
                <input type='number' value='1' name='attr_hp_max'/>
            <label>Armor Class</label>
                <input type='number' value='0' name='attr_armor_class' readonly/>
            <label>Attack Throw</label>
                <input type='number' value='10' name='attr_attack_throw' readonly/>
            <label class='redtext'>Feet / Turn</label> 
                <input type='hidden' class='movecheck' name='attr_move_is_zero'/>
                <input class='redmove' type='number' value='120' name='attr_move_turn' readonly/> 
            <label class='redtext'>Feet / Round</label> 
                <input type='hidden' class='movecheck' name='attr_move_is_zero'/>
                <input class='redmove' type='number' value='40' name='attr_move_round' readonly/>
            <label class='monster'>Alt Mode</label> 
                <input class='width45' type='text' name='attr_alt_move_mode'/> 
            <label class='monster'>Feet / Round</label> 
                <input class='width45' type='text' name='attr_alt_move'/>
            <label class='monster'>Morale</label>
                <input type='number' value='0' name='attr_morale'/>
            <label class='monster'>XP Value</label>
                <input type='number' name='attr_xp_value' />
        </div>
    </div>
    <hr/>
    <div class='grid11'>
        <div class='grid111'>
            <label class='spanheader'>Saving Throws</label>
            <label></label>
            <label>Base</label>
            <label>Mod</label>
            <button type='roll' value='@{whispertoggle} &{template:custom} {{title=@{banner_agility} **@{character_title} @{selected|token_name}**}} {{subtitle=Agility Throw}} {{color=orange}} {{Target=[[@{dex}]]}} {{Roll=[[1d20[die]+@{save_6_mod}[mod1]+?{Modifier|0}[mod2]]]}}' name='roll_save_6'> Agility</button>
                <input type='number' value='10' name='attr_dex'/>
                <input type='number' value='0' name='attr_save_6_mod'/>
            <button type='roll' value='@{whispertoggle} &{template:custom} {{title=@{banner_blast} **@{character_title} @{selected|token_name}**}} {{subtitle=Save vs. Blast & Breath}} {{color=orange}} {{Target=[[@{save_3}]]}} {{Roll=[[1d20[die]+@{wis_mod}[wis]+@{save_3_mod}[mod1]+?{Modifier|0}[mod2]]]}}' name='roll_save_3'> Blast</button>
                <input type='number' value='0' name='attr_save_3'/>
                <input type='number' value='0' name='attr_save_3_mod'/>
            <button type='roll' value='@{whispertoggle} &{template:custom} {{title=@{banner_paralysis} **@{character_title} @{selected|token_name}**}} {{subtitle=Save vs. Petrification & Paralysis}} {{color=orange}} {{Target=[[@{save_1}]]}} {{Roll=[[1d20[die]+@{wis_mod}[wis]+@{save_1_mod}[mod1]+?{Modifier|0}[mod2]]]}}' name='roll_save_1'> Paralysis</button>
                <input type='number' value='0' name='attr_save_1'/>
                <input type='number' value='0' name='attr_save_1_mod'/>
            <button type='roll' value='@{whispertoggle} &{template:custom} {{title=@{banner_poison} **@{character_title} @{selected|token_name}**}} {{subtitle=Save vs. Poison & Death}} {{color=orange}} {{Target=[[@{save_2}]]}} {{Roll=[[1d20[die]+@{wis_mod}[wis]+@{save_2_mod}[mod1]+?{Modifier|0}[mod2]]]}}' name='roll_save_2'> Poison</button>
                <input type='number' value='0' name='attr_save_2'/>
                <input type='number' value='0' name='attr_save_2_mod'/>
            <button type='roll' value='@{whispertoggle} &{template:custom} {{title=@{banner_spells} **@{character_title} @{selected|token_name}**}} {{subtitle=Save vs. Staffs & Wands}} {{color=orange}} {{Target=[[@{save_4}]]}} {{Roll=[[1d20[die]+@{wis_mod}[wis]+@{save_4_mod}[mod1]+?{Modifier|0}[mod2]]]}}' name='roll_save_4'> Staffs</button>
                <input type='number' value='0' name='attr_save_4'/>
                <input type='number' value='0' name='attr_save_4_mod'/>
            <button type='roll' value='@{whispertoggle} &{template:custom} {{title=@{banner_staffs} **@{character_title} @{selected|token_name}**}} {{subtitle=Save vs. Spells}} {{color=orange}} {{Target=[[@{save_5}]]}} {{Roll=[[1d20[die]+@{wis_mod}[wis]+@{save_5_mod}[mod1]+?{Modifier|0}[mod2]]]}}' name='roll_save_5'> Spells</button>
                <input type='number' value='0' name='attr_save_5'/>
                <input type='number' value='0' name='attr_save_5_mod'/>
        </div>
        <div class='grid1111'>
            <label class='spanheader'>Current Conditions</label>
            <label>Blinded</label>
                <input type='checkbox' value='4' name='attr_isBlinded'/>
            <label>Casting</label>
                <input type='checkbox' value='1' name='attr_isCasting'/>
            <label>Charging</label>
                <input type='checkbox' value='2' name='attr_isCharging'/>
            <label>Concentrating</label>
                <input type='checkbox' value='1' name='attr_isConcentrating'/>
            <label>Engaged</label>
                <input type='checkbox' value='1' name='attr_chkEngaged'/>
            <label>Fatigued</label>
                <input type='number' min='0' max='10' value='0' name='attr_mod_fatigued'/>
            <label>Inspired</label>
                <input type='checkbox' value='1' name='attr_isInspired'/>
            <label>Movement</label>
                <input type='number'value='0' name='attr_mod_movement'/>
            <label>Prone</label>
                <input type='checkbox' value='4' name='attr_isProne'/>
            <label>Retreating</label>
                <input type='checkbox' value='1' name='attr_isRetreating'/>
            <label>Unconscious</label>
                <input type='checkbox' value='1' name='attr_isUnconscious'/>
            <label>Withdrawing</label>
                <input type='checkbox' value='1' name='attr_isWithdrawing'/>
        </div>
    </div>
    <hr/>
</div>

<div class='combat'>
    <div class='grid1111'>
        <button type='roll' class='combatbutton' value='@{whispertoggle} &{template:custom} {{title=@{banner_init} **@{selected|character_name}**}} {{subtitle=Initiative Roll}} {{Roll=[[((1d6cs0cf0+@{dex_mod}[dex]+@{class_initiative_bonus}[class]+@{mod_initiative}[mod1]+?{Modifier|0}[mod2])*100+d99)&{tracker}]]}}' name='roll_initiative'> Initiative</button>
        <button type='roll' class='combatbutton' value='@{whispertoggle} &{template:custom} {{title=@{banner_surprise} **@{character_title} @{selected|token_name}**}} {{subtitle=Surprise Check}} {{Surprise=[[1d6cs0cf0+@{class_surprise_bonus}[class]-@{isBlinded}/2[blind]+@{mod_surprise}[mod1]+?{Modifier|0}[mod2]]]}}' name='roll_surprise'> Surprise</button>
        <button type='roll' class='combatbutton' value='@{whispertoggle} &{template:custom} {{title=@{banner_reaction} **@{character_title} @{selected|token_name}**}} {{subtitle=Reaction Roll}} {{Roll=[[2d6cs0cf0+@{cha_mod}[cha]+@{mod_reaction}[mod1]+?{Modifier|0}[mod2]]]}} {{desc=2 or less: Hostile, attacks&#13;3-5: Unfriendly, may attack&#13;6-8: Neutral, uncertain&#13;9-11: Indifferent, uninterested&#13;12+: Very Favorable}}' name='roll_reaction'> Reaction</button>
        <button type='roll' class='combatbutton' value='@{whispertoggle} &{template:custom} {{title=@{banner_morale} @{selected|token_name}**}} {{subtitle=Morale Check}} {{Roll=[[2d6cs0cf0+@{morale}[rating]+?{Modifier|0}[mod]]]}} {{desc=2 or less: Retreat&#13;3-5: Fighting Withdrawal&#13;6-8: Fight On&#13;9-11: Advance and Pursue&#13;12+: Victory or Death}}' name='roll_morale'> Morale</button>
        <input type='number' value='0' name='attr_mod_initiative'/>
        <input type='number' value='0' name='attr_mod_surprise'/>
        <input type='number' value='0' name='attr_mod_reaction'/>
        <input type='number' value='0' name='attr_mod_morale'/>
    </div>
    <hr/>
    <div class='grid11'>
        <div class='grid111'>
            <label>Armor</label>
            <label>Bonus</label>
            <label>Shield</label>
            <select name='attr_armor'>
                <option value='0' selected>Clothing Only (AC 0)</option>
                <option value='1'>Hide and Fur (AC 1)</option>
                <option value='2'>Leather (AC 2)</option>
                <option value='3'>Ring or Scale (AC 3)</option>
                <option value='4'>Chain Mail (AC 4)</option>
                <option value='5'>Banded or Lamellar (AC 5)</option>
                <option value='6'>Plate (AC 6)</option>
            </select>
            <input type='number' value='0' name='attr_armor_bonus'/>
            <input type='checkbox' value='1' name='attr_has_shield'/>
        </div>
        <div class='grid111'>
            <label class='spanheader'>Effects Generators</label>
            <button type='roll' value='@{whispertoggle} &{template:critchar} {{title=@{banner_critchar} **@{character_title} @{selected|token_name}**}} {{subtitle=Critical Effect}} {{color=red}} {{Roll=[[1d10cf0]]}}' name='roll_crit_character'> Crit Character</button>
            <button type='roll' value='@{whispertoggle} &{template:critmon} {{title=@{banner_critmon} **@{character_title} @{selected|token_name}**}} {{subtitle=Critical Effect}} {{color=red}} {{Roll=[[1d10cf0]]}}' name='roll_crit_monster'> Crit Monster</button>
            <button type='roll' value='@{whispertoggle} &{template:mortalwounds} {{title=@{banner_mortalwound} **@{character_title} @{selected|token_name}**}} {{subtitle=Mortal Wound}} {{color=black}} {{Roll=[[1d20cs0cf0[base]+?{Modifier|0}[mod]]]}} {{Severity=[[1d6]]}}' name='roll_mortal_wound'> Mortal Wound</button>
        </div>
    </div>
    <hr/>
    <div class='grid11'>
        <div class='grid1111'>
            <label>Armor Class</label>
                <input type='number' value='0' name='attr_armor_class' readonly/>
            <label>Attack Throw</label>
                <input type='number' value='10' name='attr_attack_throw'/>
        </div>
        <div class='grid11'> 
            <label>Number of Attacks: </label>
                <input type='text' value='1' name='attr_num_attacks'/>
        </div>
    </div>
    <hr/>
    <div>
        <label class='spanheader'>Melee Attacks</label>
        <fieldset class='repeating_melee'>
            <button type='roll' value='@{whispertoggle} &{template:custom} {{title=@{banner_melee} **@{character_title} @{selected|token_name}**}} {{subtitle=Melee Throw}} {{color=red}} {{Target=[[@{attack_throw}+?{Target AC|0}[target AC]]]}} {{Roll=[[1d20!+@{str_mod}[str]+@{melee_bonus}[wpn]+?{Style|Normal,0|Dual-Wield,1}[style]+?{Modifier|0}[mod]-@{isBlinded}[blind]+@{isCharging}[charge]-@{mod_fatigued}[fatigue]+@{isInspired}[inspired]-@{isProne}[prone]]]}} {{damage=[[{@{melee_damage}+@{str_mod}[str]+@{class_damage_bonus}[class]+@{isInspired}[inspired]-@{mod_fatigued}[fatigue], 0d1+1}k1]]}} {{effects=@{melee_effects}}}' name='roll_melee_attack'> Attack</button>
            <input type='text' class='attackname' placeholder='Attack name...' name='attr_melee_name'/>
            <label>Bonus:</label><input type='number' value='0' name='attr_melee_bonus'/>
            <label>Damage:</label><input class='width45' type='text' name='attr_melee_damage'/>
            <label>Effect Text: </label><input type='checkbox' class='toggle-show'/><br/>
            <div class='details'><textarea placeholder='Effects description...' name='attr_melee_effects'></textarea></div>
        </fieldset>.
    </div>
    <hr/>
    <div>
        <label class='spanheader'>Missile Attacks</label>
        <fieldset class='repeating_missile'>
            <button type='roll' value='@{whispertoggle} &{template:custom} {{title=@{banner_missile} **@{character_title} @{selected|token_name}**}} {{subtitle=Missile Throw}} {{color=red}} {{Target=[[@{attack_throw}+?{Target AC|0}[target AC]]]}} {{Roll=[[1d20!+@{dex_mod}[dex]+@{missile_bonus}[wpn]+?{Range|Short,0|Medium,-2|Long,-5}[range]+@{class_accuracy_bonus}[class]+?{Modifier|0}[mod]-@{isBlinded}[blind]-@{mod_fatigued}[fatigue]+@{isInspired}[inspired]-@{isProne}[prone]]]}} {{damage=[[{@{missile_damage}+@{isInspired}[inspired]-@{mod_fatigued}[fatigue], 0d1+1}k1]]}} {{effects=@{missile_effects}}}' name='roll_missile_attack'> Attack</button>
            <input type='text' class='attackname' placeholder='Attack name...' name='attr_missile_name'/>
            <label>Range:</label><input type='text' class='missilerange' name='attr_missile_range'/>
            <label>Bonus:</label><input type='number' value='0' name='attr_missile_bonus'/>
            <label>Damage:</label><input class='width45' type='text' name='attr_missile_damage'/>
            <label>Effect Text: </label><input type='checkbox' class='toggle-show'/><br/>
            <div class='details'><textarea placeholder='Effects description...' name='attr_missile_effects'></textarea></div>
        </fieldset>.
    </div>
    <hr/>
</div>

<div class='skills'>
    <div class='grid1'>
        <label class='spanheader'>Abilities</label>
        <div class='spanrepeater'>
            <fieldset class='repeating_abilities'>
                <button type='roll' value='@{whispertoggle} &{template:custom} {{title=@{banner_abilitythrow} **@{character_title} @{selected|token_name}**}} {{subtitle=Ability Throw}} {{color=brown}} {{Using=@{ability_name}}} {{Target=[[@{ability_target}]]}} {{Roll=[[1d20[die]+?{Modifier|0}[mod]]]}}' name='roll_ability_check'> Throw</button>
                <input type='text' placeholder='Ability name...' name='attr_ability_name'/>
                <label>Source: </label><input type='text' name='attr_ability_source'/>
                <button type='roll' value='@{whispertoggle} &{template:custom} {{title=@{banner_abilitydesc} **@{character_title} @{selected|token_name}**}} {{subtitle=Ability Description}} {{color=brown}} {{Name=@{ability_name}}} {{Source=@{ability_source}}} {{desc=@{ability_details}}}' name='roll_ability_description'> </button>
                <label>Details: </label><input type='checkbox' class='toggle-show'/><br/>
                <div class='details'>
                    <label class='detailslabel'>Target:</label><input class='skillScript' type='text' value='11' name='attr_ability_target'/><br/>
                    <textarea placeholder='Optional description...' name='attr_ability_details'></textarea>
                </div>
            </fieldset>
        </div>
    </div>
    <hr/>
    <div class='grid1'>
        <label class='spanheader'>Proficiencies</label>
        <div class='spanrepeater'>
            <fieldset class='repeating_skills'>
                <button type='roll' value='@{whispertoggle} &{template:custom} {{title=@{banner_profthrow} **@{character_title} @{selected|token_name}**}} {{subtitle=Proficiency Throw}} {{color=brown}} {{Using=@{skill_name}}} {{Target=[[@{skill_target}[base] - ((@{skill_rank}-1))*4[rank]]]}} {{Roll=[[1d20[die]+?{Modifier|0}[mod]]]}}' name='roll_skill_check'> Throw</button>
                <input type='text' placeholder='Proficiency name...' name='attr_skill_name'/>
                <label>Rank:</label><input type='number' value='1' name='attr_skill_rank'/>
                <label>Type:</label>
                    <select name='attr_skill_type'>
                        <option selected>General</option>
                        <option>Class</option>
                    </select>
                    <button type='roll' value='@{whispertoggle} &{template:custom} {{title=@{banner_profdesc} **@{character_title} @{selected|token_name}**}} {{subtitle=Proficiency Description}} {{color=brown}} {{Name=@{skill_name}}} {{Rank=@{skill_rank}}} {{Type=@{skill_type}}} {{desc=@{skill_details}}}' name='roll_ability_description'> </button>
                <label>Details: </label><input type='checkbox' class='toggle-show'/><br/>
                <div class='details'>
                    <label class='detailslabel'>Target:</label><input class='skillScript' type='text' value='11' name='attr_skill_target'/><br/>
                    <textarea placeholder='Optional description...' name='attr_skill_details'></textarea>
                </div>
            </fieldset>
        </div>
    </div>
    <hr/>
</div>

<div class='equipment'>
    <div class='grid11'>
        <div class='grid1111'>
            <label>Capacity, Max</label> <input type='number' value='20' name='attr_enc_capacity' readonly/> <input type='hidden' name='attr_mod_capacity'/>
            <label>Encumbrance</label> <input type='number' value='0' name='attr_encumbrance' readonly />
        </div>
        <div class='grid1111'> 
            <label class='redtext'>Feet / Turn</label> 
                <input type='hidden' class='movecheck' name='attr_move_is_zero'/>
                <input class='redmove' type='number' value='120' name='attr_move_turn' readonly/> 
            <label class='redtext'>Feet / Round</label> 
                <input type='hidden' class='movecheck' name='attr_move_is_zero'/>
                <input class='redmove' type='number' value='40' name='attr_move_round' readonly/>
        </div>
    </div>
    <hr/>
    <div>
        <label class='spanheader'>Equipment</label>
        <input class='toggle-show' type='checkbox' name='attr_show_equipment' checked/> show/hide
        <div class='details'>
            <fieldset class='repeating_items'>
                <input type='text' placeholder='Item name...' name='attr_item_name'/>
                <label>Weight:</label><input class='itemWeight' type='number' step='0.01' value='0.17' name='attr_item_weight'/>
                <label>Count:</label><input type='number' value='1' name='attr_item_count'/>
                <label>Value:</label><input type='number' step='0.01' name='attr_item_value'/>
                <label>Equipped:</label><input type='checkbox' value='1' name='attr_item_equipped' checked />
                <label>Description: </label><input type='checkbox' class='toggle-show'/><br/>
                <div class='details'><textarea placeholder='Optional description...' name='attr_item_details'></textarea></div>
            </fieldset>
            <input type='hidden' value='0' name='attr_items_weight'/>
        </div>
    </div>
    <hr/>
    <div class='grid11'>
        <div class='gridcurrency'>
            <input type='hidden' value='0' name='attr_currency_weight'/>
            <label class='spanheader'>Currency</label>
            <label></label><label>On Hand</label><label>Banked</label><label>Found</label><label>x:GP</label>  
            <label>PP</label>
                <input class='currency' type='number' value='0' min='0' name='attr_platinum'/>
                <input class='currency' type='number' value='0' min='0' name='attr_platinum_bank'/>
                <input class='currency' type='number' value='0' min='0' name='attr_platinum_found'/>
                <label>1:5</label>
            <label>GP</label>
                <input class='currency' type='number' value='0' min='0' name='attr_gold'/>
                <input class='currency' type='number' value='0' min='0' name='attr_gold_bank'/>
                <input class='currency' type='number' value='0' min='0' name='attr_gold_found'/>
                <label>1:1</label>
            <label>EP</label>
                <input class='currency' type='number' value='0' min='0' name='attr_electrum'/>
                <input class='currency' type='number' value='0' min='0' name='attr_electrum_bank'/>
                <input class='currency' type='number' value='0' min='0' name='attr_electrum_found'/>
                <label>2:1</label>
            <label>SP</label>
                <input class='currency' type='number' value='0' min='0' name='attr_silver'/>
                <input class='currency' type='number' value='0' min='0' name='attr_silver_bank'/>
                <input class='currency' type='number' value='0' min='0' name='attr_silver_found'/>
                <label>10:1</label>
            <label>CP</label>
                <input class='currency' type='number' value='0' min='0' name='attr_copper'/>
                <input class='currency' type='number' value='0' min='0' name='attr_copper_bank'/>
                <input class='currency' type='number' value='0' min='0' name='attr_copper_found'/>  
                <label>100:1</label>
            <label></label><label>capacity</label><label>wealth</label><label>xp</label><label></label>
            <label></label>
            <input class='currency' type='number' value='0' name='attr_currency_capacity' readonly/>
            <input class='currency' type='number' value='0' name='attr_currency_wealth' readonly/>
            <input class='currency' type='number' value='0' name='attr_currency_xp' readonly/>
        </div>
        <div class='grid11'>
            <label class='spanheader'>Monthly Cost of Living</label>
            <label>Living Standard</label>
                <select name='attr_living_standard'>
                    <option value='1'>Wretched</option>
                    <option value='3'>Meager</option>
                    <option value='12' selected>Adequate</option>
                    <option value='40'>Confortable</option>
                    <option value='100'>Prosperous</option>
                    <option value='450'>Affluent</option>
                    <option value='2000'>Sumptuous</option>
                    <option value='12000'>Luxuriant</option>
                    <option value='80000'>Lavishly Opulent</option>
                </select>
            <label>Hireling Fees</label>
                <div><input type='number' name='attr_hireling_fees' readonly/> gp</div>
            <hr class='spangrid'/>
            <label class='emphasis'>Total Fees</label>
                <div><input type='number' value='12' name='attr_total_monthly_fees' readonly/> gp</div>
        </div>
    </div>
    <hr/>
</div>

<div class='class'>

    <div>
        <label class='spanheader'>Global (Unconditional) Class Bonuses</label>
        <div class='grid11'>
            <div class='grid8'>
                <label>Accuracy:</label> <input type='number' value='0' name='attr_class_accuracy_bonus'/>
                <label>Damage:</label> <input type='number' value='0' name='attr_class_damage_bonus'/>
                <label>Initiative:</label> <input type='number' value='0' name='attr_class_initiative_bonus'/>
                <label>Surprise:</label> <input type='number' value='0' name='attr_class_surprise_bonus'/>
                <label>Armor Class:</label> <input type='number' value='0' name='attr_class_ac_bonus'/>
                <label>Morale:</label> <input type='number' value='0' name='attr_class_henchmen_morale_bonus'/>
            </div>
        </div>
        <hr/>
    </div>

    <input class='showspellcasting' type='hidden' value='1' name='attr_show_spellcasting'/>
    <div class='spellcasting'>
        <div class='gridspellslots'>
            <label class='spanheader'>Spellcasting Slots by Spell Level</label>
            <label>cantrips</label><label>level 1</label><label>level 2</label><label>level 3</label><label>level 4</label><label>level 5</label><label>level 6</label><label>Corruption</label>
            <input type='number' value='0' name='attr_cantrips_max'/>
            <input type='number' value='0' name='attr_spells_1_max' />
            <input type='number' value='0' name='attr_spells_2_max' />
            <input type='number' value='0' name='attr_spells_3_max' />
            <input type='number' value='0' name='attr_spells_4_max' />
            <input type='number' value='0' name='attr_spells_5_max' />
            <input type='number' value='0' name='attr_spells_6_max' />
            <input type='hidden' class='corruptioncheck' name='attr_corruption_too_high'/>
            <input class='redcorruption' type='number' min='0' max='30' value='0' name='attr_corruption'/>
            <input type='number' value='0' name='attr_cantrips'/>
            <input type='number' value='0' name='attr_spells_1'/>
            <input type='number' value='0' name='attr_spells_2'/>
            <input type='number' value='0' name='attr_spells_3'/>
            <input type='number' value='0' name='attr_spells_4'/>
            <input type='number' value='0' name='attr_spells_5'/>
            <input type='number' value='0' name='attr_spells_6'/>
            <button type='action' name='act_reset_spells'>Reset</button>
        </div>
        <hr/>
        <div>
            <label class='spanheader'>Available Spells</label>
            <input class='toggle-show' type='checkbox' name='attr_show_spelllist' checked/> show/hide
            <div class='details'>
                <fieldset class='repeating_spellsarcane'>
                    <button type='roll' value='@{selected|whispertoggle} &{template:custom} {{color=blue}} {{title=@{banner_spellcast} **@{character_title} @{selected|token_name}**}} {{subtitle=Cast Spell}} {{Spell=@{spell_name}}} {{Shade=@{spell_shade}}} {{Range=@{spell_range}}} {{Duration=@{spell_duration}}} {{desc=@{spell_details}}}' name='roll_cast_spell'> Cast</button>
                    <input type='text' placeholder='Spell name...' name='attr_spell_name'/>
                    <label>Level:</label><input type='number' name='attr_spell_level'/>
                    <label>Shade:</label><select class='spellshade' name='attr_spell_shade'>
                        <option value=''>select...</option>
                        <option>White</option>
                        <option>Gray</option>
                        <option>Black</option>
                    </select>
                    <label>Prepared:</label><input type='checkbox' name='attr_spell_prepared'/>
                    <label>Details: </label><input type='checkbox' class='toggle-show'/><br/>
                    <div class='details'>
                        <label class='detailslabel'>Range:</label><input type='text' name='attr_spell_range'/>
                        <label class='detailslabel'>Duration:</label><input type='text' name='attr_spell_duration'/>
                        <textarea placeholder='Spell description...' name='attr_spell_details'></textarea>
                    </div>
                </fieldset>
            </div>
        </div>
        <hr/>
    </div>

    <input class='showthievesskills' type='hidden' value='1' name='attr_show_thievesskills'/>
    <div class='thievesskills'>
        <div class='grid8'>
            <label class='spanheader'>Thieving Abilities</label>
            <input type='hidden' value='0' name='attr_thiefEncBonus'/>
            <input class='showthievesskillsall' type='hidden' name='attr_show_thievesskillsall'/>
            <input class='showthievesskillsclimb' type='hidden' name='attr_show_thievesskillsclimb'/>
            <input class='showthievesskillsthief' type='hidden' name='attr_show_thievesskillsthief'/>
            <div class='thievesskillsthief'><button type='roll' value='@{whispertoggle} &{template:custom} {{title=@{banner_locks} **@{character_title} @{selected|token_name}**}} {{subtitle=Open Locks}} {{color=black}} {{Target=[[@{thief_1}]]}} {{Roll=[[d20[die]+@{dex_mod}[dex]+?{Modifier|0}[mod]]]}}' name='roll_thief_1'> Open Locks</button></div>
            <div class='thievesskillsthief'><button type='roll' value='@{whispertoggle} &{template:custom} {{title=@{banner_traps} **@{character_title} @{selected|token_name}**}} {{subtitle=Remove Traps}} {{color=black}} {{Target=[[@{thief_2}]]}} {{Roll=[[d20[die]+@{dex_mod}[dex]+?{Modifier|0}[mod]]]}}' name='roll_thief_2'> Find Traps</button></div>
            <div class='thievesskillsthief'><button type='roll' value='@{whispertoggle} &{template:custom} {{title=@{banner_pockets} **@{character_title} @{selected|token_name}**}} {{subtitle=Pick Pockets}} {{color=black}} {{Target=[[@{thief_3}]]}} {{Roll=[[d20[die]+@{dex_mod}[dex]+?{Modifier|0}[mod]]]}}' name='roll_thief_3'> Pick Pockets</button></div>
            <div class='thievesskillsall'><button type='roll' value='/w gm &{template:custom} {{title=@{banner_sneak} **@{character_title} @{selected|token_name}**}} {{subtitle=Move Silently}} {{color=black}} {{Target=[[@{thief_4}]]}} {{Roll=[[d20[die]+@{dex_mod}[dex]+@{thiefEncBonus}[enc]+?{Modifier|0}[mod]]]}}' name='roll_thief_4'> Move Silently</button></div>
            <div class='thievesskillsclimb'><button type='roll' value='@{whispertoggle} &{template:custom} {{title=@{banner_climb} **@{character_title} @{selected|token_name}**}} {{subtitle=Climb Walls}} {{color=black}} {{Target=[[@{thief_5}]]}} {{Roll=[[d20[die]+@{dex_mod}[dex]+@{thiefEncBonus}[enc]+?{Modifier|0}[mod]]]}}' name='roll_thief_5'> Climb</button></div>
            <div class='thievesskillsall'><button type='roll' value='/w gm &{template:custom} {{title=@{banner_hide} **@{character_title} @{selected|token_name}**}} {{subtitle=Hide}} {{color=black}} {{Target=[[@{thief_6}]]}} {{Roll=[[d20[die]+@{dex_mod}[dex]+@{thiefEncBonus}[enc]+?{Modifier|0}[mod]]]}}' name='roll_thief_6'> Hide in Shadows</button></div>
            <div class='thievesskillsthief'><button type='roll' value='@{whispertoggle} &{template:custom} {{title=@{banner_listen} **@{character_title} @{selected|token_name}**}} {{subtitle=Listen}} {{color=black}} {{Target=[[@{thief_7}]]}} {{Roll=[[d20[die]+?{Modifier|0}[mod]]]}}' name='roll_thief_7'> Hear Noises</button></div>
            <input class='thiefFieldTotal' type='text' value='0' name='attr_thief_backstab'/>
        </div>
        <hr/>
    </div>
    
    <input class='showassassin' type='hidden' name='attr_show_assassin'/>
    <div class='assassin'>
        <div class='classcontent'>
            <label class='spanheader'>Assassin Class Description</label>
            <p>Prime Requisite: <strong>STR and DEX</strong></p>
            <p>Requirements: <strong>None</strong></p>
            <p>Hit Dice: <strong>1d6</strong></p>
            <p>Maximum Level: <strong>14</strong></p>
            <h5>Class Proficiencies</h5>
            <p>Acrobatics, Alchemy, Alertness, Arcane Dabbling, Blind Fighting, Bribery, Cat Burglary, Climbing, Combat Reflexes, Combat Trickery (disarm, incapacitate), Contortionism, Disguise, Eavesdropping, Fighting Style, Gambling, Intimidation, Mimicry, Precise Shooting, Running, Seduction, Skirmishing, Skulking, Sniping, Swashbuckling, Trap Finding, Weapon Finesse, Weapon Focus</p>
            <h5>Description</h5>
            <p>Assassins are humans who train to kill by ambush and treachery. Assassins may be back-alley brawlers, violent thugs, or members of an organized guild. Some assassins are members of secret orders or religious brotherhoods of trained killers, but others are simply  murderers-for-hire or rogues with a taste for violence.</p>
            <p>Assassins are expert combatants, though lacking somewhat in toughness (hit points). At first level, assassins hit an unarmored foe (AC 0) with an attack throw of 10+. They advance in attack throws and saving throws as fighters, by two points every three levels of experience. Assassins increase their base damage roll from successful missile and melee attacks by +1 at 1st level and by an additional +1 at 3rd, 6th, 9th, and 12th level.</p>
            <p>Assassins may use any weapon without limitation. Although assassins generally prefer fast, concealable, or quiet weapons, killing can occur under many circumstances. They may fight using a weapon two-handed, a weapon in each hand, or a weapon and shield.</p>
            <p>An assassin also has the ability to backstab. He must catch an opponent unaware of his presence, either by surprise or by moving silently and/or hiding in shadows to sneak up on his opponent. When backstabbing, the thief will receive an attack bonus of +4 and, if successful, deal additional damage for every four levels he has attained.</p>
            <p>Assassins may wear any type of armor, but most favor stealth over steel. When wearing leather armor or lighter garb, an assassin may move silently, hide in shadows, and backstab as a thief of the same level. If wearing armor heavier than leather, these abilities are not available:
                <ul>
                <li>Moving Silently: Thieves may move with total silence. When successful, even keen eared guards will not hear the movements of a thief. However, the thief always thinks he is successful in this skill, and will not know otherwise unless and until others react to his presence. Thieves may move silently at ½ their standard combat movement rate without penalty. If they move greater than ½ speed, they take a -5 penalty to the proficiency throw. If they run, they take a -10 penalty.</li>
                <li>Hiding in Shadows: A thief may attempt to skulk unseen in the cover of darkness. A thief will always think he is successful in this skill, and will not know otherwise until others react to his presence. A thief will remain hidden so long as he stays motionless. If he moves, he must make a new proficiency throw to hide.</li>
                </ul>
            </p>
            <p>Upon reaching 9th level (Assassin), an assassin may construct a hideout. When an assassin builds a hideout, he will gain 2d6 1st level assassin apprentices, come to learn under a master. If hired, they must be paid standard rates for ruffians. These thugs will serve the character with some loyalty, though at least one will be an infiltrator working for the assassin’s local rivals, sent to keep an eye on the character.</p>
        </div>
        <hr/>
    </div>

    <input class='showbard' type='hidden' name='attr_show_bard'/>
    <div class='bard'>
        <div class='grid11'>  
            <label class='spanheader'>Additional Bard Abilities</label>       
            <div class='grid8'>
                <button type='roll' value='@{whispertoggle} &{template:custom} {{title=@{banner_dabbling} **@{character_title} @{selected|token_name}**}} {{subtitle=Arcane Dabbling}} {{color=blue}} {{Target=[[@{bard_1}]]}} {{Roll=[[1d20+?{Modifier|0}[mod]]]}}' name='roll_bard_1'> Arcane Dabbling</button>
                <button type='roll' value='@{whispertoggle} &{template:custom} {{title=@{banner_loremastery} **@{character_title} @{selected|token_name}**}} {{subtitle=Loremastery}} {{color=brown}} {{Target=[[@{bard_2}]]}} {{Roll=[[1d20+?{Modifier|0}[mod]]]}}' name='roll_bard_2'> Loremastery</button>
            </div>
        </div>
        <hr/>
        <div class='classcontent'>
            <label class='spanheader'>Bard Class Description</label>
            <p>Prime Requisite: <strong>DEX and CHA</strong></p>
            <p>Requirements: <strong>None</strong></p>
            <p>Hit Dice: <strong>1d6</strong></p>
            <p>Maximum Level: <strong>14</strong></p>
            <h5>Class Proficiencies</h5>
            <p>Acrobatics, Art, Bargaining, Beast Friendship, Combat Trickery (disarm), Command, Diplomacy, Eavesdropping, Elven Bloodline, Fighting Style, Healing, Knowledge, Language, Leadership, Lip Reading, Magical Engineering, Magical Music, Mimicry, Mystic Aura, Performance, Precise Shooting, Prestidigitation, Running, Seduction, Skirmishing, Swashbuckling, Weapon Finesse, Weapon Focus</p>
            <h5>Description</h5>
            <p>Successful adventurers live forever in the sagas and songs about their deeds. Remembering and recounting these sagas is the profession of bards. Most bards are content to recite the deeds of others, but some bold few participate in the dangers themselves and become inspiring heroes in their own right. A bard might be an adventuring minstrel with a sword in his hand and a song at his lips, a warrior of the outlands, or even an aristocrat.</p>
            <p>Bards advance in attack throws and saving throws as a thief, by two points every four levels of experience. At first level, bards hit an unarmored foe (AC 0) with an attack throw of 10+. They may fight with any missile weapons and any one-handed melee weapons, and may wield a weapon in each hand if desired. They cannot wear armor heavier than leather, and cannot use shields.</p>
            <p>All bards can sing, recite poetry, or play a group of instruments in a skilled manner. The bard chooses the type of performance that his character knows. A bard may take the Perform proficiency to learn other types of performances.</p>
            <p>By reciting heroic lays and epic poems, bards can inspire courage. Inspiring courage requires a few moments of oration before a battle (one round), and grants the bard’s allies within a 50' radius a +1 bonus to attack throws, damage rolls, morale rolls (for monsters or NPCs allied with the bard), and saving throws against magical fear. The bonus lasts for 10 minutes (1 turn). A bard can inspire courage in any given character once per day per class level. (Even the most inspiring epic gets old if you hear it twice in the same day.) A bard cannot inspire courage on characters who are already engaged in combat.</p>
            <p>Because of their study of ancient annals and legends, bards possess loremastery. This knowledge allows them to decipher occult runes, remember ancient history, identify historic artifacts, and similar tasks. At 1st level, a bard must make a proficiency throw of 18+ on 1d20 to succeed in these tasks. The proficiency throw required reduces by 1 per level.</p>
            <p>This same knowledge allows bards to dabble in the arcane. They may attempt to use wands, staffs, and other magic items only useable by mages. At 1st level, the character must make a proficiency throw of 18+ on 1d20 or the attempt backfires in some desultory way (Judge’s discretion). The proficiency throw required reduces by 2 per level, to a minimum of 3+.</p>
            <p>Upon attaining 4th level (Annalist), the bard gains the ability to read languages, including ciphers, treasure maps, and dead languages, but not magical writings. A proficiency throw of 5+ on 1d20 is required. If the roll does not succeed, the bard may not try to read that particular piece of writing until he reaches a higher level of experience.</p>
            <p>When a bard reaches 5th level (Chronicler), his chronicles of battle inspire his hirelings to strive for glory. Any henchmen and mercenaries hired by the bard gain a +1 bonus to their morale score if the bard is there to witness and record their deeds. This bonus stacks with any modifiers from the bard’s Charisma or proficiencies.</p>
            <p>Upon reaching 9th level (Bard), a bard can build a hall and become a ruler. When he does so, up to 1d4+1x10 0th level mercenaries and 1d6 bards of 1st-3rd level will come to apply for jobs and training. If hired, they must be paid standard rates for mercenaries.</p>
            <p>At 10th level, the bard can read and cast magic from arcane scrolls with a proficiency throw of 3+ on 1d20. However, a failed throw means the spell does not function as expected, and can create a horrible effect at the Judge’s discretion.</p>
        </div>
        <hr/>
    </div>

    <input class='showbladedancer' type='hidden' name='attr_show_bladedancer'/>
    <div class='bladedancer'>
        <div class='grid11'>  
            <label class='spanheader'>Additional Bladedancer Abilities</label>       
            <div class='grid8'>
                <button type='roll' value='@{selected|whispertoggle} &{template:custom} {{title=@{selected|banner_turn} **@{selected|character_title} @{selected|token_name}**}} {{subtitle=Turn Undead}} {{color=gold}} {{Roll=[[1d20]]}} {{Hit Dice Affected=[[2d6]]}}' name='roll_turnundead'>Turn Undead</button>
            </div>
        </div>
        <hr/>
        <div class='classcontent'>
            <label class='spanheader'>Bladedancer Class Description</label>
            <p>Prime Requisite: <strong>WIS</strong></p>
            <p>Requirements: <strong>None</strong></p>
            <p>Hit Dice: <strong>1d6</strong></p>
            <p>Maximum Level: <strong>14</strong></p>
            <h5>Class Proficiencies</h5>
            <p>Acrobatics, Apostasy, Battle Magic, Beast Friendship, Combat Reflexes, Combat Trickery (knock down), Contemplation, Diplomacy, Divine Blessing, Divine Health, Fighting Style, Laying on Hands, Magical Music, Martial Training, Performance, Prestidigitation, Prophecy, Quiet Magic, Righteous Turning, Running, Seduction, Skirmishing, Swashbuckling, Theology, Unflappable Casting, Weapon Finesse, Weapon Focus</p>
            <h5>Description</h5>
            <p>Bladedancers are human women who have dedicated themselves to the service of a goddess of war. They belong to military clerical orders, where they are trained in fighting and casting spells. Most bladedancers are trained to the art from a young age. A fully trained bladedancer is highly coveted as a bodyguard and escort by great noble houses.</p>
            <p>Bladedancers are skilled combatants. At first level, bladedancers hit an unarmored foe (AC 0) with an attack throw of 10+. They advance like clerics in attack throws and saving throws, by two points every four levels of experience. By religious doctrine, bladedancers are forbidden from debasing themselves with the fighting implements of the peasantry, or dishonorably firing missiles from a distance. A bladedancer may only use piercing and slashing melee weapons, such as daggers, swords, spears, and polearms. This eliminates weapons such as clubs, maces, and warhammers, as well as bows, slings, and crossbows. </p>
            <p>A bladedancer may wield a weapon in each hand, or fight with a two-handed weapon, but may not resort to shields. Bladedancers are only trained to fight in leather or lighter armor. However, they gain a +1 bonus to initiative and a +1 bonus to Armor Class if able to move freely. At level 7, the AC bonus increases to +2, and at level 13 the AC bonus increases to +3.</p>
            <p>A bladedancer may turn undead like a cleric. Starting at 2nd level, a bladedancer may cast divine spells. Bladedancers follow the same spell progression as clerics and use the same rules for learning and casting spells. However, a bladedancer’s spell list is slightly different than a cleric’s. Like clerics, bladedancers must uphold the doctrines of their faith and god, and suffer penalties if they violate them. </p>
            <p>When a bladedancer reaches 5th level (Blade-Sister), she may begin to research spells, scribe scrolls, and brew potions. At 9th level (Blade-Mistress), she is able to create more powerful magic items such as weapons, rings, and staffs. At 11th level, a bladedancer may learn and cast ritual divine spells of great power (6th and 7th level), and craft magical constructs such as golems and animated statues. If chaotic, the bladedancer will become able to create necromantic servants and even become undead herself.</p>
            <p>When a bladedancer reaches 9th level (Blade-Mistress), she may choose to construct a temple as a stronghold. If she has not lost the favor of her deity, the cost of building the temple will be half the normal amount due to miraculous assistance from the bladedancer’s honored deity. Once the temple is completed, fanatically loyal bladedancers called the “faithful,” who need never check morale, will come to defend the Blade-Mistress. There will be 5d6x10 0th level soldiers armed with various weapons, plus another 1d6 bladedancers of 1st-3rd level to serve the order. While in the bladedancer’s service, her followers must be provided food and lodging, but need not be paid wages.</p>
        </div>
        <hr/>
    </div>

    <input class='showcleric' type='hidden' name='attr_show_cleric'/>
    <div class='cleric'>
        <div class='grid11'>  
            <label class='spanheader'>Additional Cleric Abilities</label>       
            <div class='grid8'>
                <button type='roll' value='@{selected|whispertoggle} &{template:custom} {{title=@{selected|banner_turn} **@{selected|character_title} @{selected|token_name}**}} {{subtitle=Turn Undead}} {{color=gold}} {{Roll=[[1d20]]}} {{Hit Dice Affected=[[2d6]]}}' name='roll_turnundead'>Turn Undead</button>
            </div>
        </div>
        <hr/>
        <div class='classcontent'>
            <label class='spanheader'>Cleric Class Description</label>
            <p>Prime Requisite: <strong>WIS</strong></p>
            <p>Requirements: <strong>None</strong></p>
            <p>Hit Dice: <strong>1d6</strong></p>
            <p>Maximum Level: <strong>14</strong></p>
            <h5>Class Proficiencies</h5>
            <p>Apostay, Battle Magic, Beast Friendship, Careful Overcaster, Combat Trickery (force back, overrun, sunder), Command, Contemplation, Diplomacy, Divine Blessing, Divine Health, Fighting Style, Healing, Knowledge (history), Laying on Hands, Leadership, Loremastery, Magical Engineering, Martial Training, Master Overcaster, Prestidigitation, Profession (judge), Prophecy, Quiet Magic, Righteous Turning, Sensing Evil, Sensing Power, Theology, Unflappable Casting, Village Wisdom, Weapon Focus</p>
            <h5>Description</h5>
            <p>Clerics are holy crusaders, trained to fight to further the ends of their faith. Humans who become clerics have pledged their lives to serve a particular deity or religion. To this end, they conduct their lives in a way that furthers the desires and will of their gods or goddesses. A cleric may be a priest-militant, bearing the light against evil, a cultist sworn to the chthonic powers, or anything in between.</p>
            <p>Clerics are skilled combatants, albeit not as good as fighters. At first level, clerics hit an unarmored foe (AC 0) with an attack throw of 10+. They advance in attack throws and saving throws by two points every four levels of experience (a progression midway between fighters and mages). As holy warriors, clerics are trained to wear any armor and fight with a variety of weapons.</p>
            <p>The particular weapons that clerics are trained to fight with are determined by the strictures of their religious order. If your Judge has not specified particular religious orders in his campaign, the default cleric is assumed to be a worshipper of Ammonar, God of Law and Light. Strict holy doctrine prevents these clerics from using any weapons that shed blood. The cleric of Ammonar may use only blunt weapons such as warhammers, maces, clubs, quarterstaffs, and slings. This cleric may use any shields or fight with two-handed weapons, but is not trained to fight with weapons in each hand (i.e. he may not ‘dual wield’).</p>
            <p>All clerics have the ability to turn undead, calling upon the name and power of their deity to turn away, and even destroy, undead. The potency of this ability is determined by level. There is no limit to how often a cleric may attempt to turn undead each day, but if an attempt to turn undead fails during an encounter, the cleric may not attempt to turn undead again for the remainder of that encounter. Turned undead flee the area for 10 rounds by the best and fastest means available to them. If they cannot flee, they cower in terror, taking no actions and suffering a -2 penalty to AC. If the cleric attacks turned undead in melee combat, the turning effect is broken, but he can use spells or missile weapons against them, and other characters may attack them in any fashion, without breaking the turning effect. Destroyed undead are immediately turned to ash.</p>
            <p>Certain chaotic sects teach their clerics to control undead rather than turn them. The undead are controlled for 1 turn per level of the cleric. If the undead would have been destroyed, the undead are controlled for 1 day per level of the cleric instead. Controlled undead behave as if charmed, obeying the cleric as if they were friends. However, if the controlled undead are turned or destroyed by a cleric during the duration of the control, the control is dispelled immediately. If the duration of the control ends without incident, the undead will flee (as if turned).</p>
            <p>Starting at 2nd level (Acolyte), clerics may manifest their deity’s power in the form of divine spells, which are granted through prayer and worship. The power and number of divine spells available to the character are determined by level according to the Cleric Spell Progression table.</p>
            <p>In order to use spells and turn undead, clerics must uphold the doctrines of their faith and god. If a cleric ever falls from favor, due to violating the beliefs of his god or breaking the rules of his clergy, the god may impose penalties upon the cleric. These penalties are entirely up to the Judge, but might include penalties to attack or a reduction in spells available.</p>
            <p>When a cleric reaches 5th level (Vicar), he may begin to research spells, scribe scrolls, and brew potions. At 9th level (Patriarch), he is able to create more powerful magic items such as weapons, rings, and staffs. At 11th level, a cleric may learn and cast ritual divine spells of great power (6th and 7th level), and craft magical constructs such as golems and animated statues. If chaotic, the cleric will become able to create necromantic servants and even become undead himself. These activities are explained in the Campaign chapter.</p>
            <p>Upon attaining 9th level (Patriarch), a cleric may establish or build a fortified church. So long as the cleric is currently in favor with his god, he may buy or build his fortified church at half the normal price due to divine intervention. Once a fortified church is established, the cleric’s reputation will spread and he will attract 5d6x10 0th level soldiers armed with various weapons, plus another 1d6 clerics of 1st-3rd level of the same religion to serve the order. They are completely loyal (morale +4). While in the cleric’s service, his followers must be provided food and lodging, but need not be paid wages. The Judge determines which proportions of followers are archers, infantry, etc.</p>
        </div>
        <hr/>
    </div>

    <input class='showDwarvenCraftpriest' type='hidden' name='attr_show_dwarvencraftpriest'/>
    <div class='dwarvenCraftpriest'>
        <div class='grid11'>  
            <label class='spanheader'>Additional Dwarven Craftpriest Abilities</label>
            <div class='grid8'>
                <button type='roll' value='@{selected|whispertoggle} &{template:custom} {{title=@{selected|banner_turn} **@{selected|character_title} @{selected|token_name}**}} {{subtitle=Turn Undead}} {{color=gold}} {{Roll=[[1d20]]}} {{Hit Dice Affected=[[2d6]]}}' name='roll_turnundead'>Turn Undead</button>
                <button type='roll' value='@{whispertoggle} &{template:custom} {{title=@{banner_recsymbol} **@{character_title} @{selected|token_name}**}} {{subtitle=Recognize Symbol}} {{color=gold}} {{Target=[[8]]}} {{Roll=[[1d20+?{Modifier|0}[mod]]]}}' name='roll_craftpriest_1'> Recognize Symbol</button>
            </div>
        </div>
        <hr/>
        <div class='classcontent'>
            <label class='spanheader'>Dwarven Craftpriest Class Description</label>
            <p>Prime Requisite: <strong>WIS</strong></p>
            <p>Requirements: <strong>CON 9</strong></p>
            <p>Hit Dice: <strong>1d6</strong></p>
            <p>Maximum Level: <strong>10</strong></p>
            <h5>Class Proficiencies</h5>
            <p>Alchemy, Art, Battle Magic, Caving, Collegiate Wizardry, Contemplation, Craft, Diplomacy, Divine Blessing, Divine Health, Dwarven Brewing, Endurance, Engineering, Fighting Style, Goblin-Slaying, Healing, Illusion Resistance, Knowledge, Laying on Hands, Loremastery, Magical Engineering, Mapping, Performance (chanting), Prestidigitation, Profession (judge), Prophecy, Quiet Magic, Righteous Turning, Sensing Evil, Siege Engineering, Theology, Unflappable Casting, Weapon Focus</p>
            <h5>Description</h5>
            <p>Dwarves are stout, short, bearded demi-humans who average a height of approximately 4' and weigh about 150lb. Perhaps not surprisingly, they have skin, hair and eye colors in earth tones. Dwarves have a reputation for having surly attitudes, and are particularly gruff with elves. They value precious metals and stones, and live in deep underground vaults, where they endure constant raids from the orcs, trolls, and even worse denizens of the darkness below. Dwarves are rarely seen, for their strongholds lie deep in the mountains of the world.</p>
            <p>Nothing is so revered among the dwarven people as craftsmanship. A dwarf’s work is his life, and the spirits of great dwarven artisans are believed to live on forever in their masterpieces. The veneration of these relics falls to the care of a caste of dwarves known as craftpriests. While most craftpriests attend to the shrines and monuments of their clan, young craftpriests are sometimes sent forth to recover monuments to the glorious past from the ancient ruins and wastelands of the world. This class represents such a craftpriest.</p>
            <p>At first level, dwarven craftpriests hit an unarmored foe (AC 0) with an attack throw of 10+. Dwarven craftpriests advance in attack throws and saving throws as clerics, by two points every four levels of experience. Dwarven craftpriests may wear any armor and may use any of the traditional weapons of their people, including the battle axe, great axe, hand axe, flail, mace, morning star, and  warhammer. They are trained to fight wielding a weapon and shield or wielding a weapon twohanded, but may not dual wield weapons.</p>
            <p>A dwarven craftpriest may turn undead like a cleric. Starting at 2nd level (Craft-Acolyte), a craftpriest may cast divine spells. Craftpriests follow the same spell progression as clerics, use the same rules for learning and casting spells, and select their spells from the same spell list. See the Spells chapter for details. Because of their religious training, a craftpriest can automatically identify religious symbols, trappings, and holy days of the dwarven faith, and recognizes those of other faiths with a proficiency throw of 8+ on 1d20.</p>
            <p>In addition, each dwarven craftpriest is a journeyman in a particular type of craft, such as armor-making, leatherworking, weapon-smithing, etc. With access to craftsman’s tools, the character can produce 20gp worth of items per month, and supervise 3 apprentices in his craft. When examining works of his craft, the craftpriest can identify masterwork items, rare materials, and famous artisans with a proficiency throw of 8+ on 1d20. Their attention to detail gives craftpriests a +3 bonus on proficiency rolls for other proficiencies they learn as well. </p>
            <p>Dwarves gain a +1 bonus to surprise rolls when underground due to sensitivity to the rock and stone around them. Because of their experience underground, dwarves may detect traps, false walls, hidden construction, or sloped passages with a proficiency throw of 14+ on 1d20. Dwarves must be actively searching for these abilities to function. In addition to these abilities, dwarves are particularly hardy people. The target values for all their saving throws versus Blast/Breath are reduced by 3, while the target values for all their other saving throws are reduced by 4. Dwarven characters speak the Common and Dwarvish tongue and, because of their frequent interaction underground with these monsters, also speak Goblin, Gnome, and Kobold.</p>
            <p>Starting at 5th level (Craft-Vicar), a craftpriest may begin to research spells, scribe scrolls, and brew potions. At 9th level (Craft-Lord), he is able to create more powerful magic items such as weapons, rings, and staffs, and craft magical constructs such as golems. At 9th level, he also can construct a vault that will attract dwarves from far and wide. Dwarves of the character’s clan will be the first to live under his roof, but dwarves from other clans will also come and live nearby to be ruled by the character. A total of 3d6x10 1st level NPCs of the same race will move in to help maintain and defend the vault at no cost to the character. A Craft-Lord is expected to employ only soldiers of dwarven descent, but may hire members of other races for other tasks.</p>
        </div>
        <hr/>
    </div>

    <input class='showDwarvenVaultguard' type='hidden' name='attr_show_dwarvenvaultguard'/>
    <div class='dwarvenVaultguard'>
        <div class='classcontent'>
            <label class='spanheader'>Dwarven Vaultguard Class Description</label>
            <p>Prime Requisite: <strong>STR</strong></p>
            <p>Requirements: <strong>CON 9</strong></p>
            <p>Hit Dice: <strong>1d8</strong></p>
            <p>Maximum Level: <strong>13</strong></p>
            <h5>Class Proficiencies</h5>
            <p>Alertness, Berserkergang, Blind Fighting, Caving, Combat Reflexes, Combat Trickery (force back, knock down, overrun, sunder, wrestle), Command, Craft, Dungeon Bashing, Dwarven Brewing, Endurance, Engineering, Fighting Style, Gambling, Goblin-Slaying, Illusion Resistance, Intimidation, Land Surveying, Leadership, Mapping, Manual of Arms, Military Strategy, Mountaineering, Siege Engineering, Weapon Focus</p>
            <h5>Description</h5>
            <p>Dwarves are stout, short, bearded demi-humans who average a height of approximately 4' and weigh about 150lb. Perhaps not surprisingly, they have skin, hair and eye colors in earth tones. Dwarves have a reputation for having surly attitudes, and are particularly gruff with elves. They value precious metals and stones, and live in deep underground vaults, where they endure constant raids from the orcs, trolls, and even worse denizens of the darkness below. Dwarves are rarely seen, for their strongholds lie deep in the mountains of the world.</p>
            <p>Dwarves trained to defend their race’s underground vault from the endless hordes that threaten it are called vaultguards. Though most vaultguards are born, live and die in the vault, from time to time a young vaultguard will be dispatched to foreign realms on a warrior’s pilgrimage. The few vaultguards who return from such pilgrimages bring gold and glory to their clans, often leading them to found new vaults and become great lords. The dwarven vaultguard class represents such a dwarf. </p>
            <p>Dwarven vaultguards are highly trained combatants. At first level, dwarven vaultguards hit an unarmored foe (AC 0) with an attack throw of 10+. They advance in attack throws and saving throws as fighters, by two points every three levels of experience. They increase their base damage roll from successful missile and melee attacks by +1 at 1st level, and by an additional +1 at 3rd, 6th, 9th, and 12th level. Due to their short height, dwarven vaultguards cannot use human-sized two-handed weapons (such as two-handed swords or pole arms) or longbows, but they can use any other weapon or armor. They are trained to fight wielding a weapon and shield, wielding a weapon twohanded, and wielding a weapon in each hand.</p>
            <p>Dwarves gain a +1 bonus to surprise rolls when underground due to sensitivity to the rock and stone around them. Because of their experience underground, dwarves may detect traps, false walls, hidden construction, or sloped passages with a proficiency throw of 14+ on 1d20. Dwarves must be actively searching for these abilities to function.</p>
            <p>In addition to these abilities, dwarves are particularly hardy people. The target values for all their saving throws versus Blast/Breath are reduced by 3, while the target values for all their other saving throws are reduced by 4. Dwarf characters will speak the Common and Dwarvish tongue and, because of their frequent interaction underground with these monsters, dwarves can also speak Goblin, Gnome, and Kobold.</p>
            <p>When a dwarven vaultguard reaches 9th level (Vaultlord), he can attract dwarves from far and wide by constructing his own underground vault. Dwarves usually live in clans, so dwarves of the character’s clan will be the first to live under his roof, but dwarves from other clans will also come and live nearby to be ruled by the character. A total of 3d6x10 1st level NPCs of the same race will move in to help maintain and defend the vault at no cost to the character. A dwarven vaultguard is expected to employ only soldiers of dwarven descent, but may hire members of other races for other tasks.</p>
        </div>
        <hr/>
    </div>
    
    <input class='showElvenNightblade' type='hidden' name='attr_show_elvennightblade'/>
    <div class='elvenNightblade'>
        <div class='classcontent'>
            <label class='spanheader'>Elven Nightblade Class Description</label>
            <p>Prime Requisite: <strong>DEX and INT</strong></p>
            <p>Requirements: <strong>None</strong></p>
            <p>Hit Dice: <strong>1d6</strong></p>
            <p>Maximum Level: <strong>11</strong></p>
            <h5>Class Proficiencies</h5>
            <p>Alchemy, Alertness, Battle Magic, Beast Friendship, Black Lore of Zahar, Blind Fighting, Combat Reflexes, Combat Trickery (disarm, incapacitate), Contortionism, Elementalism, Familiar, Fighting Style, Intimidation, Magical Engineering, Mystic Aura, Passing Without Trace, Precise Shooting, Prestidigitation, Quiet Magic, Running, Sensing Power, Skirmishing, Skulking, Sniping, Swashbuckling, Unflappable Casting, Trap Finding, Wakefulness, Weapon Focus, Weapon Finesse</p>
            <h5>Description</h5>
            <p>Elves are lithe, fey beings with pointed ears, delicate features, and graceful movement. They typically weigh about 130lb and stand between 5 ½' and 6' tall. Humans envy their long lifespans and seeming agelessness. Elves are a subtle race, and never does their gift for finesse and subtlety so reveal itself as in the practice of death-dealing. Cunning, deadly, and rarely seen, the elven nightblade is an assassin and sorcerer whose art is murder. Most nightblades practice their work in the courts of elven nobility. Those few who venture outside of the forests find their skills in high demand, for adventurers, aristocrats, and warlords all value their arcane and deadly ways.</p>
            <p>At first level, elven nightblades hit an unarmored foe (AC 0) with an attack throw of 10+. Elven nightblades advance in attack throws and saving throws as thieves, by two points every four levels of experience. They may use any missile weapons and any one-handed melee weapons. They may fight with a one-handed weapon in each hand, or wielding a one-handed weapon with two hands. They cannot wear armor heavier than leather, and cannot use shields or exclusively two-handed melee weapons such as great axes or polearms.</p>
            <p>An elven nightblade also has the ability to backstab. He must catch an opponent unaware of his presence, either by surprise or by moving silently and/or hiding in shadows to sneak up on his opponent. When backstabbing, the thief will receive an attack bonus of +4 and, if successful, deal additional damage for every four levels he has attained.</p>
            <p>Elven nightblades have the following range of skills:
                <ul>
                <li>Moving Silently: Thieves may move with total silence. When successful, even keen eared guards will not hear the movements of a thief. However, the thief always thinks he is successful in this skill, and will not know otherwise unless and until others react to his presence. Thieves may move silently at ½ their standard combat movement rate without penalty. If they move greater than ½ speed, they take a -5 penalty to the proficiency throw. If they run, they take a -10 penalty.</li>
                <li>Climbing Walls: Thieves are adept at scaling sheer surfaces, including walls or steep cliffs. They require a proficiency throw for each 100' they intend to climb. If the roll fails, they fall a distance equal to half the attempted distance, plus the distance covered by any previous throws, taking 1d6 points of damage per 10 feet. Thieves climb at ¼ their standard combat movement rate.</li>
                <li>Hiding in Shadows: A thief may attempt to skulk unseen in the cover of darkness. A thief will always think he is successful in this skill, and will not know otherwise until others react to his presence. A thief will remain hidden so long as he stays motionless. If he moves, he must make a new proficiency throw to hide.</li>
                </ul>
            </p>
            <p>Elven nightblades cast spells as mages of one-half their level, using the same spell list and the same rules for learning and casting spells. Unlike (human) mages, elven nightblades can also cast spells while wearing armor. They can use any magical items available to mages or thieves.</p>
            <p>Elves gain a +1 bonus to surprise rolls when in the wilderness due to their attunement to nature. Elves have keen eyes that allow them to detect hidden and secret doors with a proficiency throw of 8+ on 1d20 when actively searching, or 14+ on casual inspection. Because of their connection to nature, elves are completely unaffected by the paralysis ghouls can inflict, and the target values for all their saving throws versus Spells, Paralysis, and Petrification are reduced by 1. Elves can speak Common, Elven, Gnoll, Hobgoblin, and Orc languages.</p>
            <p>When they reach 9th level (Nightblade), elven nightblades may construct a hideout. When a nightblade builds a hideout, he will gain 2d6 1st level nightblades as apprentices, come to learn under a master. If hired, they must be paid standard rates for ruffians. These nightblades will serve the character with some loyalty, though at least one will be an infiltrator working for the elven nightblade’s local rivals, sent to keep an eye on the character.</p>
            <p>When they reach 10th level, elven nightblades may begin to research spells, scribe magical scrolls, and brew potions, as if they were 5th level mages.</p>
        </div>
        <hr/>
    </div>

    <input class='showElvenSpellsword' type='hidden' name='attr_show_elvenspellsword'/>
    <div class='elvenSpellsword'>
        <div class='classcontent'>
            <label class='spanheader'>Elven Spellsword Class Description</label>
            <p>Prime Requisite: <strong>STR and INT</strong></p>
            <p>Requirements: <strong>None</strong></p>
            <p>Hit Dice: <strong>1d6</strong></p>
            <p>Maximum Level: <strong>10</strong></p>
            <h5>Class Proficiencies</h5>
            <p>Acrobatics, Alertness, Battle Magic, Beast Friendship, Black Lore of Zahar, Blind Fighting, Combat Reflexes, Combat Trickery (disarm, knock down), Command, Elementalism, Familiar, Fighting Style, Leadership, Loremastery, Magical Engineering, Magical Music, Mystic Aura, Naturalism, Passing Without Trace, Quiet Magic, Precise Shooting, Prestidigitation, Running, Sensing Power, Skirmishing, Soothsaying, Swashbuckler, Unflappable Casting, Wakefulness, Weapon Focus, Weapon Finesse</p>
            <h5>Description</h5>
            <p>Elves are lithe, fey beings with pointed ears, delicate features, and graceful movement. They typically weigh about 130lb and stand between 5 ½' and 6' tall. Humans envy their long lifespans and seeming agelessness. Though elves are a peaceful people that enjoy poetry and art, they are also very talented fighters and skilled mages. Most elves dwell in the isolated forests; those that traffic in the kingdoms of man are both bold and remarkable.</p>
            <p>The elven spellsword class represents one such remarkable elf, trained in the arts of both fighters and mages. </p>
            <p>Elven spellswords learn an elegant, deadly style of fighting. At first level, elven spellswords hit an unarmored foe (AC 0) with an attack throw of 10+. They advance in attack throws and saving throws as fighters, by two points every three levels of experience. They increase their base damage roll from successful missile and melee attacks by +1 at 1st level, and by an additional +1 at 3rd, 6th, and 9th level. Elven spellswords can wield any weapon and wear any armor. They are trained to fight wielding a weapon and shield, wielding a two-handed weapon, and wielding a weapon in each hand.</p>
            <p>In addition to their fighting prowess, elven spellswords cast spells like a mage, using the same spell list and the same rules for learning and casting spells. Elven spellswords follow the same spell progression as mages up to 10th level. Unlike (human) mages, elven spellswords can also cast spells while wearing armor. They can use any magic item available to fighters or mages.</p>
            <p>Elves gain a +1 bonus to surprise rolls when in the wilderness due to their attunement to nature. Elves have keen eyes that allow them to detect hidden and secret doors with a proficiency throw of 8+ on 1d20 when actively searching, or 14+ on casual inspection. Because of their connection to nature, elves are completely unaffected by the paralysis ghouls can inflict, and the target values for all their saving throws versus Petrification/Paralysis and Spells are reduced by 1. Elves can speak the Common, Elven, Gnoll, Hobgoblin, and Orc languages.</p>
            <p>Starting at 5th level (Thaumaturge-Exemplar), elven spellswords may begin to research spells, scribe scrolls, and brew potions. When an elven spellsword reaches 9th level (Wizard-Lord), he is able to create more powerful magic items such as weapons, rings, and staffs.</p>
            <p>At 9th level (Wizard-Lord), elven spellswords can also establish a fastness in a natural setting, such as a forest or glen. Rather than impose upon nature, this keep must blend seamlessly with it. A total of 3d6x10 1st level elven NPCs will move in to help with it and defend the fastness at no cost to the character.</p>
        </div>
        <hr/>
    </div>

    <input class='showexplorer' type='hidden' name='attr_show_explorer'/>
    <div class='explorer'>
        <label class='spanheader'>Additional Explorer Abilities</label>
        <div class='grid8'>
            <button type='roll' value='@{whispertoggle} &{template:custom} {{title=@{banner_evade} **@{character_title} @{selected|token_name}**}} {{subtitle=Hide / Evade}} {{color=brown}} {{Target=[[?{Location|Wilds,3|Indoors,14}]]}} {{Roll=[[1d20+?{Modifier|0}[mod]]]}}' name='roll_explorer_hide'> Hide / Evade Detection</button>
        </div>
        <hr/>
        <div class='classcontent'>
            <label class='spanheader'>Explorer Class Description</label>
            <p>Prime Requisite: <strong>STR and DEX</strong></p>
            <p>Requirements: <strong>None</strong></p>
            <p>Hit Dice: <strong>1d6</strong></p>
            <p>Maximum Level: <strong>14</strong></p>
            <h5>Class Proficiencies</h5>
            <p>Alertness, Ambushing, Beast Friendship, Blind Fighting, Climbing, Combat Reflexes, Combat Trickery (disarm, knock down), Eavesdropping, Endurance, Fighting Style, Land Surveying, Mapping, Mountaineering, Naturalism, Navigation, Passing Without Trace, Precise Shooting, Riding, Running, Seafaring, Skirmishing, Sniping, Survival, Swashbuckling, Trapping, Weapon Finesse, Weapon Focus</p>
            <h5>Description</h5>
            <p>Explorers are scouts and trackers, adept at both woodcraft and archery. Few adventuring parties would dare the wilderness without an experienced explorer to guide them. An explorer might be a military scout, a barbarian hunter from the north, or a settler pushing past the borders of civilization. </p>
            <p>While they prefer to evade foes where possible, explorers are cunning warriors when they need to be. Like fighters, they advance in attack throws and saving throws by two points every three levels of experience. At first level, explorers hit an unarmored foe (AC 0) with an attack throw of 10+. In addition, they gain an accuracy bonus of +1 to all attack throws with missile weapons. Due to their careful aim, they increase their base damage roll from successful missile and melee attacks by +1 at 1st level, and by an additional +1 at 3rd, 6th, 9th, and 12th level. Explorers are trained to fight with any missile weapons and any one-handed melee weapons, and may wear chain mail or lighter armor. They may fight wielding a weapon and shield, wielding a weapon two-handed, and wielding a weapon in each hand.</p>
            <p>Explorers have animal reflexes, gaining +1 bonus to initiative and a +1 bonus to surprise rolls. Outdoors, explorers are difficult to spot, having the ability to seemingly disappear into woods and underbrush with a proficiency throw of 3+ on 1d20. In dungeons, an explorer who is motionless and quiet in cover can escape detection with a proficiency throw of 14+ on 1d20. </p>
            <p>Parties guided by explorers gain significant advantages on wilderness adventures. Any time the explorer’s party is in country familiar to the explorer, they get a +4 bonus on proficiency throws to avoid getting lost. In any terrain except clear and grassland terrain, the explorer’s party receives a +5 bonus to proficiency throws to evade wilderness encounters. A party guided by an explorer can evade wilderness encounters even when surprised on a proficiency throw of 19+.</p>
            <p>When an explorer reaches 5th level (Guide), his experience and hardiness reassures those who follow him into the wild. Hirelings on a wilderness adventure led by the explorer gain a +1 bonus to their morale score. This bonus stacks with any modifiers from the explorer’s Charisma or proficiencies. When an explorer reaches 9th level (Warden), he may decide to build a border fort in the borderlands or wilderness. When he does so, up to 1d4+1 x10 0th level mercenaries and 1d6 explorers of 1st–3rd level will come to apply for jobs and training. If hired, they must be paid standard rates for mercenaries. The character becomes the warden of any nearby settlers, and will attract more settlers over time. These people will look to the Warden as their leader, responsible for the growth and safety of their settlement.</p>
        </div>
        <hr/>
    </div>

    <input class='showfighter' type='hidden' name='attr_show_fighter'/>
    <div class='fighter'>
        <div class='classcontent'>
            <label class='spanheader'>Fighter Class Description</label>
            <p>Prime Requisite: <strong>STR</strong></p>
            <p>Requirements: <strong>None</strong></p>
            <p>Hit Dice: <strong>1d8</strong></p>
            <p>Maximum Level: <strong>14</strong></p>
            <h5>Class Proficiencies</h5>
            <p>Acrobatics, Alertness, Berserking, Blind Fighting, Combat Reflexes, Combat Trickery (disarm, force back, knock down, overrun, sunder), Command, Dungeon Bashing, Endurance, Fighting Style, Gambling, Intimidation, Leadership, Manual of Arms, Military Strategy, Precise Shooting, Riding, Running, Siege Engineering, Skirmishing, Survival, Swashbuckling, Weapon Finesse, Weapon Focus</p>
            <h5>Description</h5>
            <p>Fighters are exclusively trained in the arts of combat and war. They are specialists at dealing physical blows. Fighters may have learned their arts as warriors in wartime, gladiators battling for glory in the arena, raiding the coasts of other lands, or sell-swords in the games of the noble houses.</p>
            <p>As their name suggests, fighters are exceptionally skilled combatants. Fighters are trained in the use of all weapons and armor. They may fight wielding a weapon and shield, wielding a two-handed weapon, or wielding a weapon in each hand, as desired. At first level, fighters hit an unarmored foe (AC 0) with an attack throw of 10+. They advance in attack throws and saving throws by two points every three levels of experience (the best progression of any class). Fighters also increase their base damage roll from successful missile and melee attacks by +1 at 1st level and by an additional +1 at 3rd, 6th, 9th, and 12th level.</p>
            <p>When a fighter reaches 5th level (Exemplar), his battlefield prowess inspires others to follow him. Any henchmen and mercenaries hired by the fighter gain a +1 bonus to their morale score whenever he personally leads them. This bonus stacks with any modifiers from the fighter’s Charisma or proficiencies.</p>
            <p>At 9th level (Warlord), a fighter can, assuming enough gold is at hand, build a castle and become a great leader of men, taking a leadership rank in his society. When he does so, up to 1d4+1x10 0th level mercenaries and 1d6 fighters of 1st-3rd level will come to apply for jobs and training. If hired, they must be paid standard rates for mercenaries. Through force of arms, the fighter may ultimately control several castles or even entire realms, but must be a capable, strong leader and provide protection.</p>
        </div>
        <hr/>
    </div>

    <input class='showmage' type='hidden' name='attr_show_mage'/>
    <div class='mage'>
        <div class='classcontent'>
            <label class='spanheader'>Mage Class Description</label>
            <p>Prime Requisite: <strong>INT</strong></p>
            <p>Requirements: <strong>None</strong></p>
            <p>Hit Dice: <strong>1d4</strong></p>
            <p>Maximum Level: <strong>14</strong></p>
            <h5>Class Proficiencies</h5>
            <p>Alchemy, Battle Magic, Beast Friendship, Black Lore, Careful Overcaster, Collegiate Wizardry, Craft, Diplomacy, Elementalism, Elven Bloodline, Engineering, Familiar, Healing, Hedge Wizardry, Illusion Resistance, Knowledge, Language, Loremastery, Magical Engineering, Mapping, Master Overcaster, Mystic Aura, Naturalism, Quiet Magic, Performance, Prestidigitation, Profession, Sensing Power, Transmogrification, Soothsaying, Unflappable Casting</p>
            <h5>Description</h5>
            <p>Sometimes called wizards, sorcerers, or magicians, mages study arcane secrets and cast spells. While early in their career mages have only limited power, experienced mages are able to cast a great number of powerful spells. A mage may be a wizard steeped in ancient lore, a sinister sorcerer of darkness, or a village witch or hedge wizard with strange charms and hodgepodge traditions.</p>
            <p>Because of their devotion to arcane study, mages receive limited combat training. At first level, mages hit an unarmored foe (AC 0) with an attack throw of 10+. They advance in attack throws and saving throws only two points every six levels of experience (i.e., half as fast as fighters). They may only fight with quarterstaffs, clubs, daggers, and darts. They are unable to use shields, fight with two weapons, or wear any kind of armor. For these reasons, mages are quite vulnerable to physical danger, and in an adventuring group they should be protected.</p>
            <p>In exchange for these weaknesses, mages can learn and cast many powerful arcane spells. The number and levels of spells the mage can use in a single day increases with class level. A mage’s spell selection is limited to the spells in his repertoire. A mage’s repertoire can include a number of spells up to the number and level of spells listed for his level, increased by his Intelligence bonus. </p>
            <p>When a mage reaches 5th level (Thaumaturge), he may begin to research spells, scribe magical scrolls, and brew potions. When a mage reaches 9th level (Wizard), he is able to create more powerful magic items such as weapons, rings, and staffs. A mage may also build a sanctum, often a great tower, when he reaches 9th level. He will then attract 1d6 apprentices of 1st-3rd level plus 2d6 normal men seeking to become mages. Their intelligence scores will be above average, but many will become discouraged from the rigorous mental training and quit after 1d6 months. While in the mage’s service, apprentices must be provided food and lodging, but need not be paid wages. If the mage builds a dungeon beneath or near his tower, monsters will start to arrive to dwell within, followed shortly by adventurers seeking to fight them.</p>
            <p>At 11th level, a mage may learn and cast ritual arcane spells of great power (7th, 8th, and 9th level), craft magical constructs, and create magical cross-breeds. If chaotic, the mage may create necromantic servants and become undead.</p>
        </div>
        <hr/>
    </div>

    <input class='showthief' type='hidden' name='attr_show_thief'/>
    <div class='thief'>
        <div class='classcontent'>
            <label class='spanheader'>Thief Class Description</label>
            <p>Prime Requisite: <strong>DEX</strong></p>
            <p>Requirements: <strong>None</strong></p>
            <p>Hit Dice: <strong>1d4</strong></p>
            <p>Maximum Level: <strong>14</strong></p>
            <h5>Class Proficiencies</h5>
            <p>Acrobatics, Alertness, Arcana Dabbling, Blind Fighting, Bribery, Cat Burglary, Combat Reflexes, Combat Trickery (disarm, incapacitate), Contortionism, Diplomacy, Fighting Style, Gambling, Intimidation, Lip Reading, Lockpicking, Mapping, Precise Shooting, Riding, Running, Seafaring, Skirmishing, Skulking, Sniping, Swashbuckling, Trap Finding, Weapon Finesse, Weapon Focus</p>
            <h5>Description</h5>
            <p>Thieves have a range of unique skills associated with their profession that make them very handy companions in adventures. However, thieves can be a bit shady and they sometimes are not as trustworthy as other classes. A thief will usually belong to a Thieves’ Guild from the character’s local town, where he can seek shelter and information between adventures. At the Judge’s discretion, a thief may have to forfeit a portion of his earnings to the guild in exchange for protection. Thieves are everywhere, from the slums of the ports to the highest halls of government.</p>
            <p>Thieves are trained combatants, although not as skilled as fighters. At first level, thieves hit an unarmored foe (AC 0) with an attack throw of 10+. They advance in attack throws and saving throws by two points every four levels of experience. Because of their need for stealth and free movement, thieves cannot wear armor heavier than leather, and cannot use shields or exclusively two-handed melee weapons such as great axes or polearms. They may use any missile weapons and any one-handed melee weapons. They may fight with a one-handed weapon in each hand, or wielding a one-handed weapon with two hands. </p>
            <p>A thief also has the ability to backstab. He must catch an opponent unaware of his presence, either by surprise or by moving silently and/or hiding in shadows to sneak up on his opponent. When backstabbing, the thief will receive an attack bonus of +4 and, if successful, deal additional damage for every four levels he has attained.</p>
            <p>Thieves have the following range of skills:
                <ul>
                <li>Opening Locks: With the aid of thieves’ tools, a thief may pick mechanical locks. He may only try to pick a particular lock once, and if he fails, he may not try the same lock again until he reaches a higher experience level. The Judge may apply bonuses or penalties to the roll, depending on the complexity of the lock.</li>
                <li>Finding and Removing Traps: Through careful inspection and probing, a thief may find hidden traps and then attempt to disable or discharge the trap harmlessly. A thief may only try to find or remove a trap once in any given area. The Judge may apply bonuses or penalties to the roll, depending on the complexity of the trap. If the thief fails, he may not try again until he reaches a higher experience level. Note that these are separate skills, for a thief must find a trap before he can remove it.</li>
                <li>Picking Pockets: This skill is the bread and butter of nonadventuring thieves for it is a quick source of income – though not without peril. A throw that is less than half the target value means that the intended target notices the thieving attempt. The Judge will then make a reaction roll with a -3 penalty to determine the intended victim’s reaction.</li>
                <li>Moving Silently: Thieves may move with total silence. When successful, even keen eared guards will not hear the movements of a thief. However, the thief always thinks he is successful in this skill, and will not know otherwise unless and until others react to his presence. Thieves may move silently at ½ their standard combat movement rate without penalty. If they move greater than ½ speed, they take a -5 penalty to the proficiency throw. If they run, they take a -10 penalty.</li>
                <li>Climbing Walls: Thieves are adept at scaling sheer surfaces, including walls or steep cliffs. They require a proficiency throw for each 100' they intend to climb. If the roll fails, they fall a distance equal to half the attempted distance, plus the distance covered by any previous throws, taking 1d6 points of damage per 10 feet. Thieves climb at ¼ their standard combat movement rate.</li>
                <li>Hiding in Shadows: A thief may attempt to skulk unseen in the cover of darkness. A thief will always think he is successful in this skill, and will not know otherwise until others react to his presence. A thief will remain hidden so long as he stays motionless. If he moves, he must make a new proficiency throw to hide.</li>
                <li>Hearing Noises: Thieves can attempt to listen for noises in a cave or hallway and at a door or other locations. The thief must be quiet and in a quiet environment.</li>
                </ul>
            </p>
            <p>Upon attaining 4th level, a thief gains the ability to read languages (including ciphers, treasure maps, and dead languages, but not magical writings) with a proficiency throw of 5+ on 1d20. If the roll does not succeed, the thief may not try to read that particular piece of writing until he reaches a higher level of experience.</p>
            <p>When a thief attains 9th level (Master Thief), he can establish a hideout, and 2d6 thief apprentices of 1st level will come to work with the character. If hired, they must be paid standard rates for ruffians. A successful character might use these followers to start a Thieves’ Guild.</p>
            <p>At 10th level, a thief can read and cast magic from arcane scrolls with a proficiency throw of 3+ on 1d20. However, a failed throw means the spell does not function as expected, and can create a horrible effect at the Judge’s discretion.</p>
        </div>
        <hr/>
    </div>

    <div>
        <p>Designed for use with the Adventurer Conqueror King System and published under the ACKS SRD/OGL, https://github.com/capheind/ACKS_SRD.</p>
    </div>
</div>

<div class='hirelings'>
    <div class='grid11'>
        <div class='grid1111'>
            <label>Henchmen Limit:</label> 
                <input type='hidden' class='henchmenCheck' name='attr_henchmen_count'/>
                <input class='limitExceeded' type='number' value='4' name='attr_henchmen_limit' readonly/> 
            <label></label><label></label>
        </div>
        <div class='grid1111'>
            <label>Hireling Fees:</label><input type='number' name='attr_hireling_fees' readonly/>
            <label></label><label></label>
        </div>
    </div>
    <hr/>
    <div>
        <label class='spanheader'>Henchmen</label>
        <fieldset class='repeating_henchmen'>
            <label>Name:</label>
                <input type='text' name='attr_henchman_name'/>
            <label>Class:</label>
                <input type='text' name='attr_henchman_class'/>
            <button type='roll' value='@{whispertoggle} &{template:custom} {{title=@{banner_moralecheck} **@{henchman_name}**}} {{subtitle=Henchman Loyalty Check}} {{color=brown}} {{Roll=[[2d6cs0cf0+@{henchman_morale}[morale]+@{class_henchmen_morale_bonus}[class]+?{Modifier (if any)|0}[mod]]]}} {{desc=2 or less: Hostility&#13;3-5: Resignation&#13;6-8: Gruding Loyalty&#13;9-11: Loyalty&#13;12+: Fanatic Loyalty}}' name='roll_henchman_loyalty_check' > Morale Check</button>
            <label>Details:</label><input type='checkbox' class='toggle-show' /><br/>
            <div class='details'>
                <label>Level:</label>
                    <input type='number' min='0' max='14' value='0' name='attr_henchman_level'/>
                <label class='detailslabel'>Monthly Fee:</label>
                    <input class='currency' type='number' value='0' name='attr_henchman_fee' readonly/>
                <label class='detailslabel'>Treasure Take (%):</label>
                    <input type='number' value='15' name='attr_henchman_take'/>
                <label class='detailslabel'>Moral Bonus:</label>
                    <input type='number' value='0' name='attr_henchman_morale'>
                <textarea placeholder='Enter notes here...' name='attr_henchman_details'></textarea>
            </div>
        </fieldset>
        <input type='hidden' name='attr_henchmen_fees'/>
    </div>
    <hr/>
    <div>
        <label class='spanheader'>Mercenaries</label>
        <fieldset class='repeating_mercenaries'>
            <label>Type:</label>
                <input type='text' placeholder='See ACKS Core pg. 52...' name='attr_merc_type'/>
            <label>Quantity:</label>
                <input type='number' value='0' name='attr_merc_number'/>
            <button type='roll' value='@{whispertoggle} &{template:custom} {{title=@{banner_moralecheck} **@{merc_type}**}} {{subtitle=Mercenary Loyalty Check}} {{color=brown}} {{Roll=[[2d6cs0cf0+@{merc_morale}[bonus]+?{Modifier (if any)|0}[mod]]]}} {{desc=2 or less: Hostility&#13;3-5: Resignation&#13;6-8: Gruding Loyalty&#13;9-11: Loyalty&#13;12+: Fanatic Loyalty}}' name='roll_merc_loyalty_check' > Morale Check</button>
            <label>Details:</label><input type='checkbox' class='toggle-show' /><br/>
            <div class='details'>
                <label>Monthly Fee:</label>
                    <input type='number' value='0' name='attr_merc_fee'/>
                <label>Morale Bonus:</label>
                    <input type='number' value='0' name='attr_merc_morale'/>
                <textarea placeholder='Enter notes here...' name='attr_merc_details'></textarea>
            </div>
        </fieldset>
        <input type='hidden' name='attr_mercenary_fees'/>
    </div>
    <hr/>
    <div>
        <label class='spanheader'>Specialists</label>
        <fieldset class='repeating_specialists'>
            <label>Occupation: </label>
                <input type='text' placeholder='See ACKS Core pg. 52...' name='attr_spec_occupation'/>
            <label>Monthly Fee:</label>
                <input type='number' value='0' name='attr_spec_fee'/>
            <label>Details:</label><input type='checkbox' class='toggle-show' /><br/><div class='details'>
                <textarea placeholder='Enter notes here...' name='attr_spec_details'></textarea>
            </div>
        </fieldset>
        <input type='hidden' name='attr_specialist_fees'/>
    </div>
    <hr/>
</div>

<div class='journal'>
    <div>
        <label class='spanheader'>Character Background</label>
        <textarea placeholder='Enter details...' name='attr_background'></textarea>
    </div>
    <div class='grid111'>
        <div class='journalbox'>
            <label class='spanheader'>Languages</label>
            <textarea class='journalnotes' name='attr_languages'>Common</textarea>
        </div>
        <div class='journalbox'>
            <label class='spanheader'>Injuries</label>
            <textarea class='journalnotes' placeholder='Enter details...' name='attr_injuries'></textarea>
        </div>
        <div class='journalbox'>
            <label class='spanheader'>Property & Debts</label>
            <textarea class='journalnotes' placeholder='Enter details...' name='attr_class_notes'></textarea>
        </div>
    </div>
    <div>
        <label class='spanheader'>Adventuring Notes</label>
        <fieldset class='repeating_journal'>
            <label>Title: </label><input type='text' name='attr_journal_title'/>
            <label>Show Entry: </label><input type='checkbox' class='toggle-show' />
            <div class='details'><textarea placeholder='Enter details...' name='attr_journal_details'></textarea></div>
        </fieldset>
    </div>
    <hr/>
    <div>
        <label class='spanheader'>Experience Log</label>
        <fieldset class='repeating_experience'>            
            <label>Date: </label><input class='xpamount' type='text' name='attr_xp_date'/>
            <label>Amount: </label><input class='xpamount' type='number' name='attr_xp_amount'/>
            <label>Description: </label><input class='xpdescription' type='text' name='attr_xp_description'/>
        </fieldset>
    </div>
    <hr/>
</div>
</div>

<input type='hidden' name='attr_banner_abilitythrow' value=''/>
<input type='hidden' name='attr_banner_abilitydesc' value=''/>
<input type='hidden' name='attr_banner_agility' value=''/>
<input type='hidden' name='attr_banner_bhr' value=''/>
<input type='hidden' name='attr_banner_blast' value=''/>
<input type='hidden' name='attr_banner_cha' value=''/>
<input type='hidden' name='attr_banner_climb' value=''/>
<input type='hidden' name='attr_banner_con' value=''/>
<input type='hidden' name='attr_banner_crtichar' value=''/>
<input type='hidden' name='attr_banner_critmon' value=''/>
<input type='hidden' name='attr_banner_dabbling' value=''/>
<input type='hidden' name='attr_banner_dex' value=''/>
<input type='hidden' name='attr_banner_evade' value=''/>
<input type='hidden' name='attr_banner_hide' value=''/>
<input type='hidden' name='attr_banner_hd' value=''/>
<input type='hidden' name='attr_banner_init' value=''/>
<input type='hidden' name='attr_banner_int' value=''/>
<input type='hidden' name='attr_banner_listen' value=''/>
<input type='hidden' name='attr_banner_locks' value=''/>
<input type='hidden' name='attr_banner_loremastery' value=''/>
<input type='hidden' name='attr_banner_melee' value=''/>
<input type='hidden' name='attr_banner_missile' value=''/>
<input type='hidden' name='attr_banner_morale' value=''/>
<input type='hidden' name='attr_banner_moralecheck' value=''/>
<input type='hidden' name='attr_banner_mortalwound' value=''/>
<input type='hidden' name='attr_banner_paralysis' value=''/>
<input type='hidden' name='attr_banner_pockets' value=''/>
<input type='hidden' name='attr_banner_poison' value=''/>
<input type='hidden' name='attr_banner_profthrow' value=''/>
<input type='hidden' name='attr_banner_profdesc' value=''/>
<input type='hidden' name='attr_banner_reaction' value=''/>
<input type='hidden' name='attr_banner_recsymbol' value=''/>
<input type='hidden' name='attr_banner_sneak' value=''/>
<input type='hidden' name='attr_banner_spellcast' value=''/>
<input type='hidden' name='attr_banner_spells' value=''/>
<input type='hidden' name='attr_banner_staffs' value=''/>
<input type='hidden' name='attr_banner_str' value=''/>
<input type='hidden' name='attr_banner_surprise' value=''/>
<input type='hidden' name='attr_banner_traps' value=''/>
<input type='hidden' name='attr_banner_turn' value=''/>
<input type='hidden' name='attr_banner_wis' value=''/>

<script type='text/worker'>
const ATTR_SCORE_DEFAULT = 10;
const BASE_AC = 11;
const CAPACITY_MAX = 20;
const COIN_WEIGHT = 0.001;
const DIE_DELIMITER = 'd';
const EMPTY_STRING = '';
const HENCHMEN_LIMIT = 4;
const LEVEL_MAX = 14;
const LEVEL_MIN = 0;
const XP_BONUS_MAX = 10;

// Button panel event handlers
const buttonlist = ['overview','combat','skills','equipment','class','hirelings','journal'];
buttonlist.forEach(button => {
    on(`clicked:${button}`, function() {
        setAttrs({
            sheetButtons: button,
            sheetTab: button
        });
    });
});

// Whisper toggle
on('change:toggle_whisper', function(eventInfo) {
    /*console.log(eventInfo.sourceType + '(change:whispertoggle = ' + eventInfo.newValue + ')');*/
    const toggleValue = eventInfo.newValue.toString();
    const output = {};
    output['whispertoggle'] = (toggleValue == 'on' ? '/w gm' : EMPTY_STRING);
    setAttrs(output);
});

// Helpers/validation
// global helper to retrieve repeating section item ids
function getID(repeatingItemName) {
    const idStartPosition = repeatingItemName.indexOf('_',10) + 1;
    const idEndPosition = repeatingItemName.indexOf('_',idStartPosition+1);
    const theID = repeatingItemName.substring(idStartPosition, idEndPosition);
    return theID;
};

// isNumber function that returns true/false
var isNumber = function isNumber(value) 
{
   return typeof value === 'number' && isFinite(value);
}

// Sanitizes (lower case, no white space) a string
// Used for class names
function getSanitizedString(theString) {
    return theString.toLowerCase().replace(/\s/g, "")
}

// Ensures that a character's level falls within appropriate limits.
function validateLevel(theLevel) {
    let validatedLevel = parseInt(theLevel)|0;
    return validatedLevel < LEVEL_MIN ? LEVEL_MIN : validatedLevel > LEVEL_MAX ? LEVEL_MAX : validatedLevel;
};

/********** Armor Class **********/
on('change:armor change:armor_bonus change:has_shield change:class_ac_bonus change:dex_mod change:isCharging change:isRetreating', function(eventInfo) {
    updateArmorClass();
});

function updateArmorClass() {
    /*console.log('updateArmorClass()');*/
    getAttrs(['armor', 'armor_bonus', 'has_shield', 'class_ac_bonus', 'dex_mod', 'isCharging', 'isRetreating'], function(values) {
        const theArmorIndex = Number(values['armor']) || 0; // base AC
        const theArmorBonus = Number(values['armor_bonus']) || 0; // magic bonus, if any
        const hasShield = Number(values['has_shield']) || 0; // shield (+1 AC)
        const classACBonus = Number(values['class_ac_bonus']) || 0; // class bonus, if any
        const theDexMod = Number(values['dex_mod']) || 0; // dex modifier
        const isCharging = Number(values['isCharging']) || 0; // -2 AC
        const isRetreating = Number(values['isRetreating']) || 0; // no shield bonus

        const theAC = Math.max(0, theArmorIndex + theArmorBonus + hasShield * (isRetreating == 1 ? 0 : 1) + classACBonus + theDexMod - isCharging);
        
        const output = {};
        output['armor_class'] = theAC;
        setAttrs(output);
    });
};

/********** Attack Throw **********/
on('change:class change:level change:xp_value change:temp_hd', function(eventInfo) {
    updateAttackThrow();
});

function updateAttackThrow() {
    /*console.log('updateAttackThrow()');*/
    getAttrs(['class', 'level', 'xp_value', 'temp_hd', 'attack_throw'], function(values) {
        const theClass = getSanitizedString(values['class']);
        const theLevel = validateLevel(values['level']);
        const isMonster = parseInt(values['xp_value']) || 0;
        const monsterHD = parseInt(values['temp_hd']) || 0;
        const theAttackThrow = parseInt(values['attack_throw']) || 0;
        
        const atProfileMonster = [10,9,8,7,6,5,4,3,3,2,2,1,1,0,0,-1,-1,-2,-2,-3,-3,-4];

        const atProfile01 = [11,10,9,9,8,7,7,6,5,5,4,3,3,2,1,1]; // Fighter
        const atProfile02 = [11,10,10,10,9,9,9,8,8,8,7,7,7,6,6,6]; // Mage
        const atProfile03 = [11,10,10,9,9,8,8,7,7,6,6,5,5,4,4]; // Cleric/Thief

        let theBonus = theAttackThrow;
        if (isMonster > 0 ) {
            theBonus = atProfileMonster[monsterHD];
        } else {
            switch (theClass) {
                case 'assassin':
                case 'bladedancer':
                case 'dwarvenvaultguard':
                case 'elvenspellsword':
                case 'explorer':
                case 'fighter':
                    theBonus = atProfile01[theLevel];
                    break;
                case 'mage':
                    theBonus = atProfile02[theLevel];
                    break;
                case 'bard':
                case 'thief':
                case 'bladedancer':
                case 'cleric':
                case 'dwarvencraftpriest':
                case 'elvennightblade':
                    theBonus = atProfile03[theLevel];
                    break;
                default:
            }
        }

        const output = {};
        output['attack_throw'] = theBonus;
        setAttrs(output);
    });
};

/********** Attribute Bonuses **********/
on('change:str change:int change:wis change:dex change:con change:cha', function(eventInfo) {
    updateAttributeBonus(eventInfo.sourceAttribute);
});

function updateAttributeBonus(theAttribute) {
    /*console.log('updateAttributeBonus(' + theAttribute + ')');*/
    getAttrs([theAttribute], function(values) {
        const attrValue = Number(values[theAttribute]) || ATTR_SCORE_DEFAULT;
        
        const modifiers = [-5,-4,-3,-2,-2,-1,-1,-1,0,0,0,0,1,1,1,2,2,3,4,5]; //ACKS Core pg. 16

        const bonus = modifiers[attrValue - 1];

        const output = {};
        output[theAttribute + '_mod'] = bonus;
        setAttrs(output);
    });
};

/********** Bard Skills **********/
on('change:class change:level', function(eventInfo) {
    getAttrs(['class', 'level'], function(values) {
        const theClass = getSanitizedString(values['class']);
        const theLevel = validateLevel(values['level']);

        if(theClass == 'bard') updateBardSkills(theLevel);
    });
});

function updateBardSkills(theLevel) { 
    /*console.log('updateBardSkills(' + theLevel + ')');*/

    // ACHS Core pg. 27
    const bardSkills = [
        0,18,16,14,12,10,8,6,4,3,3,3,3,3,3,
        0,18,17,16,15,14,13,12,11,10,9,8,7,6,5     
    ];

    const output = {};
    for (var i = 0; i < 2; i++ ) output['bard_' + (i + 1)] = bardSkills[i * 15 + theLevel];
    setAttrs(output);
};

/********** Base Healing Rate **********/
on('change:hp', function(eventInfo) {
    if (eventInfo.newValue == eventInfo.previousValue) updateBHR();
});

function updateBHR() {
    /*console.log('updateBHR()');*/
    getAttrs(['hp_max'], function(values) {
        const maxHP = Number(values['hp_max']) || 0;
        
        const bhrThresholds = [0,3,9,16,23,29,36,49,63,76,89,110,140,170,1000];
        const bhrDice = ['0','1d2','1d3','1d4','1d6','1d8','1d10','2d6','2d8','2d10','2d12','3d10','4d10','5d10','6d10'];

        let bhrDie = '0';
        for (i = 0; i <= bhrThresholds.length; i++) {
            if (maxHP <= bhrThresholds[i]) {
                bhrDie = bhrDice[i];
                break;
            } 
        }

        const output = {};
        output['bhr'] = bhrDie;
        setAttrs(output);
    });
};

/********** Class Tab **********/
on('change:class', function(eventInfo) {
    updateClassTabContents();
});

function updateClassTabContents() {
    /*console.log('updateClassTabContents()');*/
    getAttrs(['class'], function(values) {
        const theClass = getSanitizedString(values['class']);

        const output = {};
        output['show_assassin'] = 
            output['show_bard'] = 
            output['show_bladedancer'] = 
            output['show_cleric'] =
            output['show_dwarvencraftpriest'] = 
            output['show_dwarvenvaultguard'] = 
            output['show_elvennightblade'] = 
            output['show_elvenspellsword'] = 
            output['show_explorer'] = 
            output['show_fighter'] = 
            output['show_mage'] = 
            output['show_spellcasting'] = 
            output['show_thief'] = 0;

        output['show_' + theClass] = 1;

        switch (theClass) {
            case 'assassin':
            case 'bard':
            case 'dwarvenvaultguard':
            case 'explorer':
            case 'fighter':
            case 'thief':
                output['show_spellcasting'] = 0;
                break;
            default:
                output['show_spellcasting'] = 1;
        }
        
        switch (theClass) {
            case 'bard':
            case 'bladedancer':
            case 'cleric':
            case 'dwarvencraftpriest':
            case 'dwarvenvaultguard':
            case 'elvenspellsword':
            case 'explorer':
            case 'fighter':
            case 'mage':
                output['show_thievesskills'] = 0;
                break;
            case 'assassin':
                output['show_thievesskills'] = 1;
                output['show_thievesskillsall'] = 1;
                output['show_thievesskillsclimb'] = 0;
                output['show_thievesskillsthief'] = 0;
                break;
            case 'elvennightblade':
                output['show_thievesskills'] = 1;
                output['show_thievesskillsall'] = 1;
                output['show_thievesskillsclimb'] = 1;
                output['show_thievesskillsthief'] = 0;
                break;
                break;
            default:
                output['show_thievesskills'] = 1;
                output['show_thievesskillsall'] = 1;
                output['show_thievesskillsclimb'] = 1;
                output['show_thievesskillsthief'] = 1;
        }
        setAttrs(output);
    });
};

/********** Class AC Bonus ****************/
on('change:class change:level', function(eventInfo) {
    getAttrs(['class', 'level'], function(values) {
        const theClass = getSanitizedString(values['class']);
        const theLevel = Number(values['level']) || 0;

        updateClassACBonus(theClass, theLevel);
    });
});

function updateClassACBonus(theClass, theLevel) {
    /*console.log('updateClassACBonus(' + theClass + ', ' + theLevel + ')');*/
    const acBonuses = [0,1,1,1,1,1,1,2,2,2,2,2,2,3,3]; // ACKS Core pg. 28

    const output = {};
    output['class_ac_bonus'] = ((theClass == 'bladedancer') ? acBonuses[theLevel] : 0);
    setAttrs(output);
};

/********** Class Accuracy Bonus ****************/
on('change:class', function(eventInfo) {
    getAttrs(['class'], function(values) {
        const theClass = getSanitizedString(values['class']);

        updateClassAccuracyBonus(theClass);
    });
});

function updateClassAccuracyBonus(theClass) {
    /*console.log('updateClassAccuracyBonus(' + theClass + ')');*/

    const output = {};
    output['class_accuracy_bonus'] = ((theClass == 'explorer') ? 1 : 0);
    setAttrs(output);
};

/********** Class Damage Bonus ****************/
on('change:class change:level change:xp_value', function(eventInfo) {
    getAttrs(['class', 'level', 'xp_value'], function(values) {
        const theClass = getSanitizedString(values['class']);
        const theLevel = Number(values['level']) || 0;
        const theXPValue = Number(values['xp_value']) || 0;

        updateClassDamageBonus(theClass, theLevel, theXPValue);
    });
});

function updateClassDamageBonus(theClass, theLevel, theXPValue) {
    /*console.log('updateClassDamageBonus(' + theClass + ', ' + theLevel + ', ' + theXPValue + ')');*/
    const damageBonuses = [0,1,1,2,2,2,3,3,3,4,4,4,5,5,5]; // ACKS Core pg. 19

    const output = {};
    output['class_damage_bonus'] = (theXPValue != 0 ? 0 : ((theClass == 'assassin' || theClass == 'explorer' || theClass == 'fighter' || theClass == 'dwarvenvaultguard' || theClass == 'elvenspellsword') ? damageBonuses[theLevel] : 0));
    setAttrs(output);
};

/********** Class Initiative Bonus ****************/
on('change:class', function(eventInfo) {
    getAttrs(['class'], function(values) {
        const theClass = values['class'].toLowerCase();

        updateClassInitiativeBonus(theClass);
    });
});

function updateClassInitiativeBonus(theClass) {
    /*console.log('updateClassInitiativeBonus(' + theClass + ')');*/

    const output = {};
    output['class_initiative_bonus'] = ((theClass == 'bladedancer' || theClass == 'explorer') ? 1 : 0);
    setAttrs(output);
};

/********** Class Morale Bonus ****************/
on('change:class change:level', function(eventInfo) {
    getAttrs(['class', 'level'], function(values) {
        const theClass = values['class'].toLowerCase();
        const theLevel = Number(values['level']) || 0;

        updateClassHenchmenMoraleBonus(theClass, theLevel);
    });
});

function updateClassHenchmenMoraleBonus(theClass, theLevel) {
    /*console.log('updateClassHenchmenMoraleBonus(' + theClass + ', ' + theLevel + ')');*/

    const output = {};
    output['class_henchmen_morale_bonus'] = (((theClass == 'explorer' || theClass == 'fighter') && theLevel > 4) ? 1 : 0);
    setAttrs(output);
};

/********** Class Surprise Bonus ****************/
on('change:class', function(eventInfo) {
    getAttrs(['class'], function(values) {
        const theClass = getSanitizedString(values['class']);

        updateClassSurpriseBonus(theClass);
    });
});

function updateClassSurpriseBonus(theClass) {
    /*console.log('updateClassSurpriseBonus(' + theClass + ')');*/

    const output = {};
    output['class_surprise_bonus'] = ((theClass == 'explorer') ? 1 : 0);
    setAttrs(output);
};

/********** Corruption Check **********/
on('change:wis change:corruption', function(eventInfo) {
    getAttrs(['wis', 'corruption'], function(values) {
        const theWis = Number(values['wis']) || 0;
        const theCorruption = Number(values['corruption']) || 0;

        const output = {};
        output['corruption_too_high'] = (theCorruption >= theWis) ? 1 : 0;
        setAttrs(output);
    });
});

/********** Cost of Living ****************/
on('change:living_standard change:hireling_fees', function(eventInfo) {
    updateCostOfLiving();
});

function updateCostOfLiving() {
    /*console.log('updateCostOfLiving()');*/
    getAttrs(['living_standard', 'hireling_fees'], function(values) {
        const theLivingStandard = Number(values['living_standard']) || 0;
        const theHirelingFees = Number(values['hireling_fees']) || 0;
        
        const totalMonthlyFees = theLivingStandard + theHirelingFees;

        const output = {};
        output['total_monthly_fees'] = totalMonthlyFees;
        setAttrs(output);
    });
};

/********** Currency Wealth **********/
on('change:gold change:silver change:copper change:electrum change:platinum change:gold_bank change:silver_bank change:copper_bank change:electrum_bank change:platinum_bank', function(eventInfo) {
    updateCurrencyWealth();
});

function updateCurrencyWealth() {
    /*console.log('updateCurrencyWealth()');*/
    getAttrs(['gold', 'silver', 'copper', 'electrum', 'platinum', 'gold_bank', 'silver_bank', 'copper_bank', 'electrum_bank', 'platinum_bank'], function(values) {
        const coinsGold = Number(values['gold']) || 0;
        const coinsSilver = Number(values['silver']) || 0;
        const coinsCopper = Number(values['copper']) || 0;
        const coinsElectrum = Number(values['electrum']) || 0;
        const coinsPlatinum = Number(values['platinum']) || 0;
        const coinsGoldBank = Number(values['gold_bank']) || 0;
        const coinsSilverBank = Number(values['silver_bank']) || 0;
        const coinsCopperBank = Number(values['copper_bank']) || 0;
        const coinsElectrumBank = Number(values['electrum_bank']) || 0;
        const coinsPlatinumBank = Number(values['platinum_bank']) || 0;
        
        const totalWealth = 
            Math.floor((
            coinsGold*100 +  
            coinsSilver*10 + 
            coinsCopper +
            coinsElectrum*50 +
            coinsPlatinum*500 +
            coinsGoldBank*100 + 
            coinsSilverBank*10 + 
            coinsCopperBank +
            coinsElectrumBank*50 +
            coinsPlatinumBank*500
            )/100); // Convert all to copper, then back to gold

        const output = {};
        output['currency_wealth'] = totalWealth;
        setAttrs(output);
    });
};

/********** Currency Weight **********/
on('change:gold change:silver change:copper change:electrum change:platinum change:gold_found change:silver_found change:copper_found change:electrum_found change:platinum_found', function(eventInfo) {
    updateCurrencyWeight();
});

function updateCurrencyWeight() {
    /*console.log('updateCurrencyWeight()');*/
    getAttrs(['gold', 'silver', 'copper', 'electrum', 'platinum', 'gold_found', 'silver_found', 'copper_found', 'electrum_found', 'platinum_found'], function(values) {
        const coinsGold = Number(values['gold']) || 0;
        const coinsSilver = Number(values['silver']) || 0;
        const coinsCopper = Number(values['copper']) || 0;
        const coinsElectrum = Number(values['electrum']) || 0;
        const coinsPlatinum = Number(values['platinum']) || 0;
        const coinsGoldFound = Number(values['gold_found']) || 0;
        const coinsSilverFound = Number(values['silver_found']) || 0;
        const coinsCopperFound = Number(values['copper_found']) || 0;
        const coinsElectrumFound = Number(values['electrum_found']) || 0;
        const coinsPlatinumFound = Number(values['platinum_found']) || 0;
        
        const totalCoins = 
            coinsGold + 
            coinsSilver + 
            coinsCopper + 
            coinsElectrum + 
            coinsPlatinum +
            coinsGoldFound + 
            coinsSilverFound + 
            coinsCopperFound + 
            coinsElectrumFound + 
            coinsPlatinumFound;
        const totalWeight = totalCoins * COIN_WEIGHT;

        const output = {};
        output['currency_weight'] = totalWeight;
        setAttrs(output);
    });
};

/********** Currency, Found XP **********/
on('change:gold_found change:silver_found change:copper_found change:electrum_found change:platinum_found', function(eventInfo) {
    updateCurrencyXP();
});

function updateCurrencyXP() {
    /*console.log('updateCurrencyXP()');*/
    getAttrs(['gold_found', 'silver_found', 'copper_found', 'electrum_found', 'platinum_found'], function(values) {
        const coinsGoldFound = Number(values['gold_found']) || 0;
        const coinsSilverFound = Number(values['silver_found']) || 0;
        const coinsCopperFound = Number(values['copper_found']) || 0;
        const coinsElectrumFound = Number(values['electrum_found']) || 0;
        const coinsPlatinumFound = Number(values['platinum_found']) || 0;
        
        const totalXP = 
            Math.floor((
            coinsGoldFound*100 +
            coinsSilverFound*10 + 
            coinsCopperFound +
            coinsElectrumFound*50 +
            coinsPlatinumFound*500
            )/100); // Convert all to copper, then back to gold

        const output = {};
        output['currency_xp'] = totalXP;
        setAttrs(output);
    });
};

/********** Encumbrance **********/
on('change:currency_weight change:items_weight change:enc_capacity', function(eventInfo) {
    updateEncumbrance();
});

function updateEncumbrance() {
    /*console.log('updateEncumbrance()');*/
    getAttrs(['currency_weight', 'items_weight', 'enc_capacity'], function(values) {
        const theCurrencyWeight = Number(values['currency_weight']) || 0;
        const theItemWeight = Number(values['items_weight']) || 0;
        const theMaxCapacity = Number(values['enc_capacity']) || 0;
        
        const theEncumbrance = theCurrencyWeight + theItemWeight;
        const theCurrencyCapacity = (theMaxCapacity - theEncumbrance) / COIN_WEIGHT;

        const output = {};
        output['encumbrance'] = Math.ceil(theEncumbrance);
        output['currency_capacity'] = Math.ceil(theCurrencyCapacity);
        setAttrs(output);
    });
};

/********** Encumbrance Capacity **********/
on('change:str_mod change:mod_capacity', function(eventInfo) {
    updateEncumbranceCapacity();
});

function updateEncumbranceCapacity() {
    /*console.log('updateEncumbranceCapacity()');*/
    getAttrs(['str_mod', 'mod_capacity'], function(values) {
        const strMod = Number(values['str_mod']) || 0;
        const capacityMod = Number(values['mod_capacity']) || 0;

        let encCapacity = CAPACITY_MAX + strMod + capacityMod;

        const output = {};
        output['enc_capacity'] = encCapacity;
        setAttrs(output);
    });
};

/********** Fees **********/
on('change:repeating_henchmen:henchman_fee remove:repeating_henchmen', function(eventInfo) {
    updateHenchmenFees();
});

function updateHenchmenFees() {
    /*console.log('updateHenchmenFees()');*/

    getSectionIDs('repeating_henchmen', function (ids) {
        const feeHenchFieldnames = [];
        ids.forEach(id => {
            feeHenchFieldnames.push('repeating_henchmen_' + id + '_henchman_fee');
        });
        
        getAttrs([...feeHenchFieldnames], function (values) {
            let totalFees = 0;
            const output = {};
            ids.forEach(id => {
                const itemFee = parseFloat(values['repeating_henchmen_' + id + '_henchman_fee'])||0;
                totalFees += itemFee;
            });
            output['henchmen_fees'] = totalFees;
            setAttrs(output);
        });
    });
};

on('change:repeating_mercenaries:merc_fee change:repeating_mercenaries:merc_number remove:repeating_mercenaries', function(eventInfo) {
    updateMercenaryFees();
});

function updateMercenaryFees() {
    /*console.log('updateMercenaryFees()');*/

    getSectionIDs('repeating_mercenaries', function (ids) {
        const feeMercFieldnames = [];
        const numMercFieldnames = [];
        ids.forEach(id => {
            feeMercFieldnames.push('repeating_mercenaries' + id + '_merc_fee');
            numMercFieldnames.push('repeating_mercenaries' + id + '_merc_number');
        });
        
        getAttrs([...feeMercFieldnames, ...numMercFieldnames], function (values) {
            let totalFees = 0;
            const output = {};
            ids.forEach(id => {
                const itemFee = parseFloat(values['repeating_mercenaries' + id + '_merc_fee'])||0;
                const itemNum = parseFloat(values['repeating_mercenaries' + id + '_merc_number'])||0;
                console.log('itemNum: ' + itemNum);
                totalFees += itemFee * itemNum;
            });
            output['mercenary_fees'] = totalFees;
            setAttrs(output);
        });
    });
};

on('change:repeating_specialists:spec_fee remove:repeating_specialists', function(eventInfo) {
    updateSpecialistFees();
});

function updateSpecialistFees() {
    /*console.log('updateSpecialistFees()');*/

    getSectionIDs('repeating_specialists', function (ids) {
        const feeSpecFieldnames = [];
        ids.forEach(id => {
            feeSpecFieldnames.push('repeating_specialists' + id + '_spec_fee');
        });
        
        getAttrs([...feeSpecFieldnames], function (values) {
            let totalFees = 0;
            const output = {};
            ids.forEach(id => {
                const itemFee = parseFloat(values['repeating_specialists' + id + '_spec_fee'])||0;
                totalFees += itemFee;
            });
            output['specialist_fees'] = totalFees;
            setAttrs(output);
        });
    });
};

on('change:henchmen_fees change:mercenary_fees change:specialist_fees', function(eventInfo) {
    updateHirelingFees();
});

function updateHirelingFees() {
    /*console.log('updateHirelingFees()');*/
        
    getAttrs(['henchmen_fees', 'mercenary_fees', 'specialist_fees'], function (values) {
        const theHenchmenFees = Number(values['henchmen_fees']) || 0;
        const theMercenaryFees = Number(values['mercenary_fees']) || 0;
        const theSpecialistFees = Number(values['specialist_fees']) || 0;

        const output = {};
        output['hireling_fees'] = theHenchmenFees + theMercenaryFees + theSpecialistFees;
        setAttrs(output);
    });
};

/********** Henchmen Limit **********/
on('change:cha_mod', function(eventInfo) {
    updateHenchmenLimit();
});

function updateHenchmenLimit() {
    /*console.log('updateHenchmenLimit()');*/
    getAttrs(['cha_mod'], function(values) {
        const chaMod = Number(values['cha_mod']) || 0;
        
        const output = {};
        output['henchmen_limit'] = HENCHMEN_LIMIT + chaMod;
        setAttrs(output);
    });
};

/********** Henchmen Limit Check **********/
on('change:repeating_henchmen:henchman_name remove:repeating_henchmen change:henchmen_limit', function(eventInfo) {
    countHenchmen();
});

function countHenchmen() {
    /*console.log('countHenchmen()');*/
    getAttrs(['henchmen_limit'], function(values) {
        const henchmenLimit = Number(values['henchmen_limit']) || HENCHMEN_LIMIT;

        getSectionIDs('repeating_henchmen', function (ids) {
            const numHenchmen = ids.length;
            
            const output = {};
            output['henchmen_count'] = (numHenchmen > henchmenLimit ? 1: 0);
            setAttrs(output);
        });
    });
};

/********** Henchman Fee **************/
on('change:repeating_henchmen:henchman_level', function(eventInfo) {
    updateHenchmanFee(getID(eventInfo.sourceAttribute), eventInfo.newValue);
});

function updateHenchmanFee(theRowId, theLevel) {
    /*console.log('updateHenchmanFee(' + theRowId + ',' + theLevel + ')');*/

    const henchmenFees = [12,25,50,100,200,400,800,1600,3000,7250,12000,32000,50000,135000,350000];
    
    const output = {};
    output['repeating_henchmen_' + theRowId + '_henchman_fee'] = henchmenFees[theLevel];
    setAttrs(output);
};

/********** Hit Die, Set **********/
on('change:hit_dice', function(eventInfo) {
    if (eventInfo.sourceType == "player") {
        getAttrs(['hit_dice'], function(values) {
            const output = {};
            output['hit_dice'] = validateHitDice(values['hit_dice']); 
            setAttrs(output);
        });
    }
});

function validateHitDice(theHitDice) {
    /*console.log('validateHitDice(' + theHitDice + ')');*/

    const theDelimiter = theHitDice.toLowerCase().indexOf(DIE_DELIMITER);
    if (theDelimiter == -1) return EMPTY_STRING; // bad string    
    const numberOfHitDice = theHitDice.substr(0,theDelimiter);
    if (isNaN(numberOfHitDice)) return EMPTY_STRING; // bad string
    const restOfString = theHitDice.substr(theDelimiter + 1);
    const theOperator = restOfString.indexOf('+') > -1 ? restOfString.indexOf('+') : restOfString.indexOf('-') > -1 ? restOfString.indexOf('-') : -1;
    const numSides = theOperator != -1 ? restOfString.substr(0,theOperator) : restOfString;
    if (isNaN(numSides)) return EMPTY_STRING; // bad string
    const modValue = theOperator != -1 ? restOfString.substr(theOperator + 1) : 0;
    if (isNaN(modValue)) return EMPTY_STRING; // bad string  
    
    // All tests passed = set hit die and temp HD
    const output = {};
    output['hit_die'] = DIE_DELIMITER + numSides; 
    output['temp_hd'] = numberOfHitDice; 
    setAttrs(output);

    return theHitDice;
};

/********** Hit Point Check/Validation **********/
on('change:hp', function(eventInfo) {
    if (eventInfo.sourceType == "player") validateHitPoints(); 
});

function validateHitPoints() {
    /*console.log('validateHitPoints()');*/
    getAttrs(['hp', 'hp_max'], function(values) {
        const theHP = parseInt(values['hp']) || 0;
        const theHPMax = parseInt(values['hp_max']) || 0;

        const validatedHP = theHP > theHPMax ? theHPMax : theHP;

        const output = {};
        output['hp'] = validatedHP;
        output['hp_is_below_one'] = (validatedHP < 1 ? 1 : 0);
        setAttrs(output);
    });
};

/********** Items **********/
on('change:repeating_items:item_weight change:repeating_items:item_count change:repeating_items:item_equipped remove:repeating_items', function(eventInfo) {
    updateItemEncumbrance(
        'repeating_items', 
        '_item_weight',
        '_item_count',
        '_item_equipped',
        'items_weight'
        );
});

function updateItemEncumbrance(
    repeatingName, 
    encPropName,
    countPropName,
    equippedPropName,
    outputName) {
    /*console.log('updateItemEncumbrance(' + repeatingName + ', ' + encPropName + ', ' + countPropName + ', ' + outputName + ')');*/
    getSectionIDs(repeatingName, function (ids) {
        const encFieldnames = [];
        const countFieldnames = [];
        const equippedFieldnames = [];
        ids.forEach(id => {
            encFieldnames.push(repeatingName + '_' + id + encPropName);
            countFieldnames.push(repeatingName + '_' + id + countPropName);
            equippedFieldnames.push(repeatingName + '_' + id + equippedPropName);
        });
        
        getAttrs([...encFieldnames, ...countFieldnames, ...equippedFieldnames], function (values) {
            const output = {};
            let totalEnc = 0;
            ids.forEach(id => {
                const itemEnc = parseFloat(values[repeatingName + '_' + id + encPropName]);
                const itemCount = parseFloat(values[repeatingName + '_' + id + countPropName])||0;
                const equipped = parseInt(values[repeatingName + '_' + id + equippedPropName]);

                totalEnc += equipped == 1 ? itemEnc * itemCount : 0;
            });
            output[outputName] = totalEnc;
            setAttrs(output);
        });
    });
};

/********** Level **********/
on('change:class', function(eventInfo) {
    setMaxLevel(); 
});

function setMaxLevel() {
    /*console.log('setMaxLevel()');*/
    getAttrs(['class'], function(values) {
        const theClass = getSanitizedString(values['class']);

        const output = {};        
        switch (theClass) {
            default:
                output['max_level'] = LEVEL_MAX;
        }
        setAttrs(output);
    });
};

/********** Movement Speed **********/
on('change:enc_capacity change:encumbrance change:isBlinded change:isCasting change:isConcentrating change:isProne change:isUnconscious change:isWithdrawing change:mod_movement', function(eventInfo) {
    updateMovementSpeed();
});

function updateMovementSpeed() {
    /*console.log('updateMovementSpeed()');*/
    getAttrs(['enc_capacity', 'encumbrance', 'isBlinded', 'isCasting', 'isConcentrating', 'isProne', 'isUnconscious', 'isWithdrawing', 'mod_movement'], function(values) {
        const encCapacity = Number(values['enc_capacity']) || 0; // how much can be carried?
        const theEncumbrance = Number(values['encumbrance']) || 0; // how much is being carried?
        const isBlinded = Number(values['isBlinded']) || 0; // quarter-speed
        const isCasting = Number(values['isCasting']) || 0; // can't move
        const isConcentrating = Number(values['isConcentrating']) || 0; // half-speed
        const isProne = Number(values['isProne']) || 0; // 5' maximum speed
        const isUnconscious = Number(values['isUnconscious']) || 0; // can't move
        const isWithdrawing = Number(values['isWithdrawing']) || 0; // half-speed
        const movementMod = Number(values['mod_movement']) || 0; // conditional modifier

        const moveThresholds = [5,7,10,encCapacity,999]; //ACKS Core, pg. 48
        const moveThresholdIndex = moveThresholds.findIndex(element => theEncumbrance < element);

        const moveSpeeds = [120,90,60,30,0]; //ACKS Core, pg. 48
        const moveDivisor = isBlinded == 4 ? 4 : ((isWithdrawing == 1 || isConcentrating == 1) ? 2 : 1);
        const theMovementSpeed = ((isCasting == 1 || isUnconscious == 1) ? 0 : ((isProne == 4) ? 15 : (moveSpeeds[moveThresholdIndex] + movementMod) / moveDivisor));
        const isMovementZero = (theMovementSpeed > 0 ? 0 : 1);
        
        const output = {};
        output['move_turn'] = theMovementSpeed;
        output['move_round'] = theMovementSpeed / 3;
        output['move_is_zero'] = isMovementZero;
        setAttrs(output);
    });
};

/********** Saving Throws, Level 1 **********/
on('change:class change:level', function(eventInfo) {
    updateSavingThrows();
});

function updateSavingThrows() {
    /*console.log('updateSavingThrows()');*/
    getAttrs(['class', 'level'], function(values) {
        const theClass = getSanitizedString(values['class']);
        const theLevel = validateLevel(values['level']);

        const clericSaves = [16,15,17,17,18,13,10,16,13,15,13,10,16,13,15,12,9,15,12,14,12,9,15,12,14,11,8,14,11,13,11,8,14,11,13,10,7,13,10,12,10,7,13,10,12,9,6,12,9,11,9,6,12,9,11,8,5,11,8,10,8,5,11,8,10,7,4,10,7,9,7,4,10,7,9];
        const craftpriestSaves = [16,15,17,17,18,9,6,13,9,11,9,6,13,9,11,8,5,12,8,10,8,5,12,8,10,7,4,11,7,9,7,4,11,7,9,6,3,10,6,8,6,3,10,6,8,5,2,9,5,7,5,2,9,5,7,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0];
        const fighterSaves = [16,15,17,17,18,15,14,16,16,17,14,13,15,15,16,14,13,15,15,16,13,12,14,14,15,12,11,13,13,14,12,11,13,13,14,11,10,12,12,13,10,9,11,11,12,10,9,11,11,12,9,8,10,10,11,8,7,9,9,10,8,7,9,9,10,7,6,8,8,9,6,5,7,7,8];
        const mageSaves = [16,15,17,17,18,13,13,15,11,12,13,13,15,11,12,13,13,15,11,12,12,12,14,10,11,12,12,14,10,11,12,12,14,10,11,11,11,13,9,10,11,11,13,9,10,11,11,13,9,10,10,10,12,8,9,10,10,12,8,9,10,10,12,8,9,9,9,11,7,8,9,9,11,7,8];
        const nightbladeSaves = [16,15,17,17,18,12,13,16,14,14,12,13,16,14,14,11,12,15,13,13,11,12,15,13,13,10,11,14,12,12,10,11,14,12,12,9,10,13,11,11,9,10,13,11,11,8,9,12,10,10,8,9,12,10,10,7,8,11,9,9,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0];
        const thiefSaves = [16,15,17,17,18,13,13,16,14,15,13,13,16,14,15,12,12,15,14,13,12,12,15,14,13,11,11,14,12,13,11,11,14,12,13,10,10,13,11,12,10,10,13,11,12,9,9,12,10,11,9,9,12,10,11,8,8,11,9,10,8,8,11,9,10,7,7,10,8,9,7,7,10,8,9];
        const spellswordSaves = [16,15,17,17,18,14,14,16,16,16,13,13,15,15,15,13,13,15,15,15,12,12,14,14,14,11,11,13,13,13,11,11,13,13,13,10,10,12,12,12,9,9,11,11,11,9,9,11,11,11,8,8,10,10,10,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0];
        const vaultguardSaves = [16,15,17,17,18,11,10,13,12,13,10,9,12,11,12,10,9,12,11,12,9,8,11,10,11,8,7,10,9,10,8,7,10,9,10,7,6,9,8,9,6,5,8,7,8,6,5,8,7,8,5,4,7,6,7,4,3,6,5,6,4,3,6,5,6,3,2,5,4,5,0,0,0,0,0];

        const output = {};
        for (var i = 0; i < 5; i++ ) {
            switch (theClass) {
                case 'bladedancer':
                case 'cleric':
                    output['save_' + (i + 1)] = clericSaves[(theLevel) * 5 + i];
                    break;
                case 'dwarvencraftpriest':
                    output['save_' + (i + 1)] = craftpriestSaves[(theLevel) * 5 + i];
                    break;
                case 'assassin':
                case 'explorer':
                case 'fighter':
                    output['save_' + (i + 1)] = fighterSaves[(theLevel) * 5 + i];
                    break;
                case 'mage':
                    output['save_' + (i + 1)] = mageSaves[(theLevel) * 5 + i];
                    break;
                case 'elvenspellsword':
                    output['save_' + (i + 1)] = spellswordSaves[(theLevel) * 5 + i];
                    break;
                case 'bard':
                case 'thief':
                    output['save_' + (i + 1)] = thiefSaves[(theLevel) * 5 + i];
                    break;
                case 'dwarvenvaultguard':
                    output['save_' + (i + 1)] = vaultguardSaves[(theLevel) * 5 + i];
                    break;
                case 'elvennightblade':
                    output['save_' + (i + 1)] = nightbladeSaves[(theLevel) * 5 + i];
                    break;
                default:
            }
        }
        setAttrs(output);
    });
};

/********** Spellcasting **********/
on('change:class change:level change:int_mod', function(eventInfo) {
    getAttrs(['class'], function(values) {
        const theClass = getSanitizedString(values['class']);

        if (theClass == 'bladedancer' || theClass == 'cleric' || theClass == 'dwarvencraftpriest' || theClass == 'mage' || theClass == 'elvennightblade' || theClass == 'elvenspellsword') updateSpellcasting();
    });
});

function updateSpellcasting() {
    /*console.log('updateSpellcasting()');*/
    getAttrs(['class', 'level', 'int_mod', 'cantrips_max'], function(values) {
        const theClass = getSanitizedString(values['class']);
        const theLevel = validateLevel(values['level']);
        const theIntMod = Number(values['int_mod']) || 0;
        const maxCantrips = Number(values['cantrips_max']) || 0;

        const clericSpellSlots = [0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,2,0,0,0,0,2,1,0,0,0,2,2,0,0,0,2,2,1,1,0,2,2,2,1,1,3,3,2,2,1,3,3,3,2,2,4,4,3,3,2,4,4,4,3,3,5,5,4,4,3,5,5,5,4,3,6,5,5,5,4];
        const mageSpellSlots = [0,0,0,0,0,0,1,0,0,0,0,0,2,0,0,0,0,0,2,1,0,0,0,0,2,2,0,0,0,0,2,2,1,0,0,0,2,2,2,0,0,0,3,2,2,1,0,0,3,3,2,2,0,0,3,3,3,2,1,0,3,3,3,3,2,0,4,3,3,3,2,1,4,4,3,3,3,2,4,4,4,3,3,2,4,4,4,4,3,3];
        const nightbladeSpellSlots = [0,0,0,0,0,0,1,0,0,2,0,0,2,0,0,2,1,0,2,1,0,2,2,0,2,2,0,2,2,1,2,2,1,2,2,2,0,0,0,0,0,0,0,0,0];

        const output = {};        
        for (var i = 0; i < 6; i++ ) output['spells_' + (i + 1) + '_max'] = output['spells_' + (i + 1)] = 0; // blank all values
        switch (theClass) {
            case 'bladedancer':
            case 'cleric':
            case 'dwarvencraftpriest':
                for (var i = 0; i < 5; i++ ) output['spells_' + (i + 1) + '_max'] = output['spells_' + (i + 1)] = clericSpellSlots[(theLevel) * 5 + i];
                break;
            case 'mage':
            case 'elvenspellsword':
                for (var i = 0; i < 6; i++ ) output['spells_' + (i + 1) + '_max'] = output['spells_' + (i + 1)] = mageSpellSlots[(theLevel) * 6 + i] + (mageSpellSlots[(theLevel) * 6 + i] > 0 ? theIntMod : 0);
                break;
            case 'elvennightblade':
                for (var i = 0; i < 3; i++ ) output['spells_' + (i + 1) + '_max'] = output['spells_' + (i + 1)] = nightbladeSpellSlots[(theLevel) * 3 + i] + (nightbladeSpellSlots[(theLevel) * 3 + i] > 0 ? theIntMod : 0);
                break;
            default:        
        }        
        output['cantrips'] = maxCantrips;
        setAttrs(output);
    });
};

/********** Spells Reset **********/
on('clicked:reset_spells', function(eventInfo) {
    updateSpellcasting();
});

/********** Thief Skills **********/
on('change:class change:level', function(eventInfo) {
    getAttrs(['class', 'level'], function(values) {
        const theClass = getSanitizedString(values['class']);
        const theLevel = validateLevel(values['level']);

        if(theClass == 'assassin' || theClass == 'elvennightblade' || theClass == 'thief') updateThiefSkills(theClass, theLevel);
    });
});

function updateThiefSkills(theClass, theLevel) { 
    /*console.log('updateThiefSkills(' + theClass + ', ' + theLevel + ')');*/

    const assassinSkills = [
        0,17,16,15,14,13,12,10,8,6,4,2,2,1,1,
        0,19,18,17,16,15,14,12,10,8,6,4,3,2,1   
    ]; //ACKS Core pg. 26
    const nightbladeSkills = [
        0,17,16,15,14,13,12,10,8,6,4,2,2,1,1,
        0,6,5,5,4,4,4,3,3,3,3,2,2,1,1,
        0,19,18,17,16,15,14,12,10,8,6,4,3,2,1
    ]; //ACKS Core pg. 36
    const thiefSkills = [
        0,18,17,16,15,14,12,10,8,6,4,3,2,1,1,
        0,18,17,16,15,14,13,11,9,7,5,3,2,2,1,
        0,17,16,15,14,13,12,10,8,6,4,2,-1,-3,-5,
        0,17,16,15,14,13,12,10,8,6,4,2,2,1,1,
        0,6,5,5,4,4,4,3,3,3,3,2,2,1,1,
        0,19,18,17,16,15,14,12,10,8,6,4,3,2,1,
        0,14,13,12,11,10,9,8,7,6,5,4,3,2,1       
    ]; //ACKS Core pg. 23
    const backstab = [
        0,2,2,2,2,3,3,3,3,4,4,4,4,5,5
    ]; //ACKS Core pg. 24

    const output = {};
    for (var i = 0; i < 7; i++ ) output['thief_' + (i + 1)] = 99;
    switch (theClass) {
        case 'assassin':
            output['thief_4'] = assassinSkills[theLevel];
            output['thief_6'] = assassinSkills[15 + theLevel];
            break;
        case 'elvennightblade':
            output['thief_4'] = nightbladeSkills[theLevel];
            output['thief_5'] = nightbladeSkills[15 + theLevel];
            output['thief_6'] = nightbladeSkills[30 + theLevel];
            break;
        case 'thief':
            for (var i = 0; i < 7; i++ ) output['thief_' + (i + 1)] = thiefSkills[i * 15 + theLevel];
            break;
        default:
    }    
    output['thief_backstab'] = 'BS x' + backstab[theLevel]; // Set backstab multiplier
    setAttrs(output);
};

/********** Thief Enc Bonus **********/
on('change:class change:encumbrance', function(eventInfo) {
    getAttrs(['class', 'encumbrance'], function(values) {
        const theClass = getSanitizedString(values['class']);
        const theEncumbrance = Number(values['encumbrance']) || 0;

        if(theClass == 'elvennightblade' || theClass == 'thief') updateThiefEncBonus(theEncumbrance);
    });
});

function updateThiefEncBonus(theEncumbrance) { 
    /*console.log('updateThiefEncBonus(' + theEncumbrance + ')');*/

    const output = {};
    output['thiefEncBonus'] = (theEncumbrance <= 2 ? 5 : (theEncumbrance <= 4 ? 2 : 0));
    setAttrs(output);
};

/********** Titles **********/
on('change:class change:level change:xp_value', function(eventInfo) {
    updateTitle();
});

function updateTitle() {
    /*console.log('updateTitle()');*/
    getAttrs(['class', 'level', 'xp_value'], function(values) {
        const theClass = getSanitizedString(values['class']);
        const theLevel = validateLevel(values['level']);
        const theXPValue = Number(values['xp_value']) || 0;
        
        const assassinTitles = ['Thug','Thug','Enforcer','Torturer','Slayer','Destroyer','Executioner','Blackguard','Assassin','Master Assassin','Master Assassin','Master Assassin','Master Assassin','Master Assassin','Grandfather of Assassins'];
        const bardTitles = ['Reciter','Reciter','Versifier','Archivist','Annalist','Chronicler','Panegyrist','Skald','Rhapsodist','Bard','Bard','Bard','Bard','Bard','Master Bard'];
        const bladedancerTitles = ['Blade-Initiate','Blade-Initiate','Blade-Daughter','Blade-Singer','Blade-Weaver','Blade-Sister','Blade-Adept','Blade-Dancer','Blade-Priestess','Blade-Mistress','Blade-Mistress','Blade-Mistress','Blade-Mistress','Blade-Mistress','Mistress of All Blades'];
        const clericTitles = ['Catechist','Catechist','Acolyte','Priest','Curate','Vicar','Rector','Prelate','Bishop','Patriarch','Patriarch','Patriarch','Patriarch','Patriarch','Theocrat'];
        const craftpriestTitles = ['Dwarven Craft-Catechist','Dwarven Craft-Catechist','Dwarven Craft-Acolyte','Dwarven Craftpriest','Dwarven Craft-Curate','Dwarven Craft-Vicar','Dwarven Craft-Rector','Dwarven Craft-Prelate','Dwarven Craft-Bishop','Dwarven Craft-Lord','Dwarven Craft-Lord','Dwarven Craft-Lord','Dwarven Craft-Lord','Dwarven Craft-Lord','Dwarven Craft-Lord'];
        const explorerTitles = ['Scout','Scout','Outrider','Forester','Explorer','Guide','Tracker','Pathfinder','Ranger','Warden','Warden','Warden','Warden','Warden','Lord Warden'];
        const fighterTitles = ['Man-at-Arms','Man-at-Arms','Warrior','Swordmaster','Hero','Exemplar','Myrmidon','Champion','Epic Hero','Warlord','Warlord','Warlord','Warlord','Warlord','Overlord'];
        const mageTitles = ['Arcanist','Arcanist','Seer','Theurgist','Magician','Thaumaturge','Enchanter','Sorcerer','Mage','Wizard','Wizard','Wizard','Wizard','Wizard','Archmage'];
        const nightbladeTitles = ['Arcanist-Avenger','Arcanist-Avenger','Seer-Enforcer','Theurgist-Torturer','Magician-Slayer','Thaumaturge-Destroyer','Enchanter-Executioner','Sorcerer-Blackguard','Mage-Assassin','Nightblade','Nightblade','Nightblade','Nightblade','Nightblade','Nightblade'];
        const spellswordTitles = ['Arcanist-Guardian','Arcanist-Guardian','Warrior-Seer','Theurgist-Swordmaster','Magician-Hero','Thaumaturge-Exemplar','Myrmidon-Enchanter','Sorcerer-Champion','Epic Hero-Mage','Wizard-Lord','Wizard-Lord','Wizard-Lord','Wizard-Lord','Wizard-Lord','Wizard-Lord'];
        const thiefTitles = ['Footpad','Footpad','Hood','Robber','Burglar','Rogue','Scoundrel','Pilferer','Thief','Master Thief','Master Thief','Master Thief','Master Thief','Master Thief','Prince of Thieves'];
        const vaultguardTitles = ['Sentry','Sentry','Warden','Shieldbearer','Defender','Sentinel','Guardian','Champion','Vaultguard','Vaultlord','Vaultlord','Vaultlord','Vaultlord','Vaultlord','Vaultlord'];
        
        const output = {};
        if (theXPValue != 0) {
            output['character_title'] = EMPTY_STRING; // Monsters don't have titles
        } else {
            switch (theClass) {
                case 'assassin': output['character_title'] = assassinTitles[theLevel]; break;
                case 'bard': output['character_title'] = bardTitles[theLevel]; break;
                case 'bladedancer': output['character_title'] = bladedancerTitles[theLevel]; break;
                case 'cleric': output['character_title'] = clericTitles[theLevel]; break;
                case 'dwarvencraftpriest': output['character_title'] = craftpriestTitles[theLevel]; break;
                case 'explorer': output['character_title'] = explorerTitles[theLevel]; break;
                case 'fighter': output['character_title'] = fighterTitles[theLevel]; break;
                case 'mage': output['character_title'] = mageTitles[theLevel]; break;
                case 'elvennightblade': output['character_title'] = nightbladeTitles[theLevel]; break;
                case 'elvenspellsword': output['character_title'] = spellswordTitles[theLevel]; break;
                case 'thief': output['character_title'] = thiefTitles[theLevel]; break;
                case 'dwarvenvaultguard': output['character_title'] = vaultguardTitles[theLevel]; break;
                default: output['character_title'] = EMPTY_STRING;
            }
        }

        setAttrs(output); 
    });
};

/********** XP Bonus **********/
on('change:str change:int change:wis change:dex change:con change:cha change:str_pre change:int_pre change:wis_pre change:dex_pre change:con_pre change:cha_pre', function(eventInfo) {
    calculateXPBonus();
});

function calculateXPBonus() {
    /*console.log('calculateXPBonus()');*/
    getAttrs(['str', 'int', 'wis', 'dex', 'con', 'cha', 'str_pre', 'int_pre', 'wis_pre', 'dex_pre', 'con_pre', 'cha_pre'], function(values) {
        const attributes = [values['str'],values['int'],values['wis'],values['dex'],values['con'],values['cha']];
        const prerequisites = [values['str_pre'],values['int_pre'],values['wis_pre'],values['dex_pre'],values['con_pre'],values['cha_pre']];
        
        const output = {};
        let theBonus = XP_BONUS_MAX;
        let noPrereq = 1;
        for (var i = 0; i < 6; i++) {
            if (prerequisites[i] == 'on') {
                theBonus = Math.min(theBonus,(attributes[i] > 15 ? 10 : (attributes[i] > 12 ? 5 : 0)));
                noPrereq = 0;
            }
        }
        output['xp_bonus'] = (noPrereq == 1 ? 0 : theBonus);
        setAttrs(output); 
    });
};

/********** XP Needed for Next Level **********/
on('change:class change:level', function(eventInfo) {
    calculateXPNeeded();
});

function calculateXPNeeded() {
    /*console.log('calculateXPNeeded()');*/
    getAttrs(['class', 'level'], function(values) {
        const theClass = getSanitizedString(values['class']);
        const theLevel = validateLevel(values['level']);
        
        const assassinXPNeeded = [100,1700,3400,6800,14000,28000,55000,110000,230000,350000,470000,590000,710000,830000,0];
        const bardXPNeeded = [100,1400,2800,5600,11200,22400,45000,90000,190000,290000,390000,490000,590000,690000,0];
        const clericXPNeeded = [100,1500,3000,6000,12000,24000,50000,100000,200000,300000,400000,500000,600000,700000,0];
        const craftpriestXPNeeded = [100,2400,4800,9600,19200,38400,75000,150000,280000,410000,0,0,0,0,0];
        const fighterXPNeeded = [100,2000,4000,8000,16000,32000,65000,130000,250000,370000,490000,610000,730000,850000,0];
        const mageXPNeeded = [100,2500,5000,10000,20000,40000,80000,160000,310000,460000,610000,760000,910000,1060000,0];
        const nightbladeXPNeeded = [100,2775,5550,11100,22200,45000,90000,180000,330000,480000,630000,0,0,0,0];
        const spellswordXPNeeded = [100,4000,8000,16000,32000,64000,130000,260000,430000,600000,0,0,0,0,0];
        const thiefXPNeeded = [100,1250,2500,5000,10000,20000,40000,80000,180000,280000,380000,480000,580000,680000,0];
        const vaultguardXPNeeded = [100,2200,4400,8800,17500,35000,70000,140000,270000,400000,530000,660000,790000,0,0];
        
        const output = {};
        output['xp_next_level'] = 0;
        switch (theClass) {
            case 'assassin':
                output['xp_next_level'] = assassinXPNeeded[theLevel];
                break;
            case 'bard':
                output['xp_next_level'] = bardXPNeeded[theLevel];
                break;
            case 'bladedancer':
            case 'cleric':
                output['xp_next_level'] = clericXPNeeded[theLevel];
                break;
            case 'dwarvencraftpriest':
                output['xp_next_level'] = craftpriestXPNeeded[theLevel];
                break;
            case 'explorer':
            case 'fighter':
                output['xp_next_level'] = fighterXPNeeded[theLevel];
                break;
            case 'mage':
                output['xp_next_level'] = mageXPNeeded[theLevel];
                break;            
            case 'elvennightblade':
                output['xp_next_level'] = nightbladeXPNeeded[theLevel];
                break;
            case 'elvenspellsword':
                output['xp_next_level'] = spellswordXPNeeded[theLevel];
                break;
            case 'thief':
                output['xp_next_level'] = thiefXPNeeded[theLevel];
                break;
            case 'dwarvenvaultguard':
                output['xp_next_level'] = vaultguardXPNeeded[theLevel];
                break;
            default: output['xp_next_level'] = EMPTY_STRING;
        }
        setAttrs(output); 
    });
};

</script>

<rolltemplate class="sheet-rolltemplate-custom">
    <div class="sheet-container sheet-color-{{color}}">
      <div class="sheet-header">
        {{#title}}<div class="sheet-title">{{title}}</div>{{/title}}
        {{#subtitle}}<div class="sheet-subtitle">{{subtitle}}</div>{{/subtitle}}
      </div>
      <div class="sheet-content">
        {{#allprops() title subtitle color damage desc effects loyalty surprise}}
        <div class="sheet-key">{{key}}</div>
        <div class="sheet-value">{{value}}</div>
        {{/allprops() title subtitle color damage desc effects loyalty surprise}}
        
        {{#effects}}
        <div class="sheet-key">Effects</div>
        <div class="sheet-value">{{effects}}</div>
        {{/effects}}

        {{#^rollLess() Roll Target}}
        <div class="sheet-key">Result</div>
        <div class="sheet-value"><span class="success">Success!</span></div>
            {{#damage}}
            <div class="sheet-key">Damage</div>
            <div class="sheet-value">{{damage}}</div>
            {{/damage}}
        {{/^rollLess() Roll Target}}
        {{#rollLess() Roll Target}}
        <div class="sheet-key">Result</div>
        <div class="sheet-value"><span class="failure">Failure!</span></div>
        {{/rollLess() Roll Target}}

        {{#rollLess() Surprise 3}}
        <div class="sheet-key">Result</div>
        <div class="sheet-value"><span class="failure">Surprised!</span></div>
        {{/rollLess() Surprise 3}}
        {{#^rollLess() Surprise 3}}
        <div class="sheet-key">Result</div>
        <div class="sheet-value"><span class="success">Unsurprised!</span></div>
        {{/^rollLess() Surprise 3}}

        {{#desc}}<div class="sheet-desc">{{desc}}</div>{{/desc}}
      </div>
    </div>
</rolltemplate>

<rolltemplate class="sheet-rolltemplate-menu">
    <div class="sheet-container sheet-color-{{color}}">
         <div class="sheet-header">
            {{#title}}<div class="sheet-title">{{title}}</div>{{/title}}
            {{#subtitle}}<div class="sheet-subtitle">{{subtitle}}</div>{{/subtitle}}
        </div>
         <div class="sheet-content">
            {{#allprops() title subtitle desc color}}
                <div class="sheet-key">{{key}}</div>
                <div class="sheet-value">{{value}}</div>
            {{/allprops() title subtitle desc color}}
            {{#desc}}
                <div class="sheet-desc">{{desc}}</div>
            {{/desc}}
        </div>
    </div>
</rolltemplate>

<rolltemplate class="sheet-rolltemplate-mortalwounds">
    <div class="sheet-container sheet-color-{{color}}">
      <div class="sheet-header">
        {{#title}}<div class="sheet-title">{{title}}</div>{{/title}}
        {{#subtitle}}<div class="sheet-subtitle">{{subtitle}}</div>{{/subtitle}}
      </div>
      <div class="sheet-content">
        {{#allprops() title subtitle color}}
        <div class="sheet-key">{{key}}</div>
        <div class="sheet-value">{{value}}</div>
        {{/allprops() title subtitle color}}

        <div class="sheet-key">Condition & Recovery</div>
        {{#rollGreater() Roll 25}}
        <div class="sheet-value"><span>You were just dazed. You recover immediately with 1hp. You do not need any bed rest.</span></div>
        <div class="sheet-key">Permanent Wounds Suffered</div>
            {{#rollTotal() Severity 1}}
            <div class="sheet-value"><span>You suffer lasting wounds that ache in bad weather (-1 to initiative rolls on cold or rainy days).</span></div>
            {{/rollTotal() Severity 1}}
            {{#rollTotal() Severity 2}}
            <div class="sheet-value"><span>You lose 1d3 toes on one foot (3 lost toes on one foot makes leg lame).</span></div>
            {{/rollTotal() Severity 2}}
            {{#rollTotal() Severity 3}}
            <div class="sheet-value"><span>You suffer minor scarring (no effect, but three minor scars equals one notable scar).</span></div>
            {{/rollTotal() Severity 3}}
            {{#rollTotal() Severity 4}}
            <div class="sheet-value"><span>Ghostly visions of lost companions flicker before your eyes as you awaken.</span></div>
            {{/rollTotal() Severity 4}}
            {{#rollTotal() Severity 5}}
            <div class="sheet-value"><span>A vision of afterlife haunts you, then fades as you awaken.</span></div>
            {{/rollTotal() Severity 5}}
            {{#rollTotal() Severity 6}}
            <div class="sheet-value"><span>The Choosers of the Slain pass you by, and you awaken.</span></div>
            {{/rollTotal() Severity 6}}
        {{/rollGreater() Roll 25}}
        {{#rollBetween() Roll 21 25}}
        <div class="sheet-value"><span>You were knocked out. You recover with 1hp. You will need magical healing or 1 night's bed rest afterward.</span></div>
        <div class="sheet-key">Permanent Wounds Suffered</div>
            {{#rollTotal() Severity 1}}
            <div class="sheet-value"><span>Your wounds heal stiff and scarred (-1 to all initiative rolls).</span></div>
            {{/rollTotal() Severity 1}}
            {{#rollTotal() Severity 2}}
            <div class="sheet-value"><span>You suffer notable scarring (-2 to throws to impersonate another; 3 notable scars become gruesome).</span></div>
            {{/rollTotal() Severity 2}}
            {{#rollTotal() Severity 3}}
            <div class="sheet-value"><span>You lose 1d3 fingers on one hand (3 lost fingers on one hand makes hand useless).</span></div>
            {{/rollTotal() Severity 3}}
            {{#rollTotal() Severity 4}}
            <div class="sheet-value"><span>You suffer minor scarring (no effect, but three minor scars equals one notable scar).</span></div>
            {{/rollTotal() Severity 4}}
            {{#rollTotal() Severity 5}}
            <div class="sheet-value"><span>Ghostly visions of lost companions flicker before your eyes as you awaken.</span></div>
            {{/rollTotal() Severity 5}}
            {{#rollTotal() Severity 6}}
            <div class="sheet-value"><span>A vision of afterlife  haunts you, then fades as you awaken.</span></div>
            {{/rollTotal() Severity 6}}
        {{/rollBetween() Roll 21 25}}
        {{#rollBetween() Roll 16 20}}
        <div class="sheet-value"><span>You are in shock. You recover with 1hp. You need magical healing and one night's bed rest; or 1 week's bed rest.</span></div>
        <div class="sheet-key">Permanent Wounds Suffered</div>
            {{#rollTotal() Severity 1}}
            <div class="sheet-value"><span>You suffer gruesome scarring (impossible to impersonate another; +2 to intimidate others, -4 to all other reaction rolls).</span></div>
            {{/rollTotal() Severity 1}}
            {{#rollTotal() Severity 2}}
            <div class="sheet-value"><span>Your genitals are damaged (cannot reproduce, -3 to reaction rolls if loss of manhood / womanhood is known).</span></div>
            {{/rollTotal() Severity 2}}
            {{#rollTotal() Severity 3}}
            <div class="sheet-value"><span>You suffer notable scarring (-2 to throws to impersonate another; 3 notable scars become gruesome).</span></div>
            {{/rollTotal() Severity 3}}
            {{#rollTotal() Severity 4}}
            <div class="sheet-value"><span>You suffer damage to your hips and lower back (cannot force march).</span></div>
            {{/rollTotal() Severity 4}}
            {{#rollTotal() Severity 5}}
            <div class="sheet-value"><span>You suffer minor scarring (no effect, but three minor scars become notable).</span></div>
            {{/rollTotal() Severity 5}}
            {{#rollTotal() Severity 6}}
            <div class="sheet-value"><span>Ghostly visions of lost companions flicker before your eyes as you awaken.</span></div>
            {{/rollTotal() Severity 6}}
        {{/rollBetween() Roll 16 20}}
        {{#rollBetween() Roll 11 15}}
        <div class="sheet-value"><span>You are critically wounded. You die unless healed to 1hp within 1 day. If you are healed, you need 1 week's bed rest.</span></div>
        <div class="sheet-key">Permanent Wounds Suffered</div>
            {{#rollTotal() Severity 1}}
            <div class="sheet-value"><span>Your heart and lungs are damaged (must rest for 2 turns every 6, wilderness movement reduced by 1/3, cannot force march, CON reduced by 1/3).</span></div>
            {{/rollTotal() Severity 1}}
            {{#rollTotal() Severity 2}}
            <div class="sheet-value"><span>One of your legs is lamed (movement reduced by 30', DEX reduced by 1/3 for AC purposes).</span></div>
            {{/rollTotal() Severity 2}}
            {{#rollTotal() Severity 3}}
            <div class="sheet-value"><span>One of your hands is severed or crushed (cannot dual wield or use two-handed weapons).</span></div>
            {{/rollTotal() Severity 3}}
            {{#rollTotal() Severity 4}}
            <div class="sheet-value"><span>One of your knees is damaged (carrying capacity reduced by 6 stone, cannot force march).</span></div>
            {{/rollTotal() Severity 4}}
            {{#rollTotal() Severity 5}}
            <div class="sheet-value"><span>One of your eyes is damaged (-2 to missile attack throws at medium and long range).</span></div>
            {{/rollTotal() Severity 5}}
            {{#rollTotal() Severity 6}}
            <div class="sheet-value"><span>1d6 of your teeth are knocked out (-2 to reaction rolls with opposite sex and upper class NPCs).</span></div>
            {{/rollTotal() Severity 6}}
        {{/rollBetween() Roll 11 15}}
        {{#rollBetween() Roll 6 10}}
        <div class="sheet-value"><span>You are grievously wounded. You die unless healed to 1hp within 1 turn. If you are healed, you need 2 week's bed rest.</span></div>
        <div class="sheet-key">Permanent Wounds Suffered</div>
            {{#rollTotal() Severity 1}}
            <div class="sheet-value"><span>You are permanently addled from brain trauma (-2 on magical research and proficiency throws, -10% penalty on earned XP).</span></div>
            {{/rollTotal() Severity 1}}
            {{#rollTotal() Severity 2}}
            <div class="sheet-value"><span>Both your legs are lamed (crutch required, movement rate reduced by 60', DEX reduced by 2/3 for AC purposes).</span></div>
            {{/rollTotal() Severity 2}}
            {{#rollTotal() Severity 3}}
            <div class="sheet-value"><span>One of your arms is severed or crushed (cannot climb, use shields, dual wield, or use two-handed weapons).</span></div>
            {{/rollTotal() Severity 3}}
            {{#rollTotal() Severity 4}}
            <div class="sheet-value"><span>One of your legs is severed or crushed (crutch or peg required, movement reduced by 30', DEX reduced by 1/3 for AC purposes).</span></div>
            {{/rollTotal() Severity 4}}
            {{#rollTotal() Severity 5}}
            <div class="sheet-value"><span>One of your eyes is destroyed (-2 to missile attack throws).</span></div>
            {{/rollTotal() Severity 5}}
            {{#rollTotal() Severity 6}}
            <div class="sheet-value"><span>One of your ears is crushed/mangled (-1 to hear noise throws, -1 to surprise rolls).</span></div>
            {{/rollTotal() Severity 6}}
        {{/rollBetween() Roll 6 10}}
        {{#rollBetween() Roll 1 5}}
        <div class="sheet-value"><span>You are mortally wounded. You die unless healed to 1hp within 1 round. If you are healed, you need 1 month's bed rest.</span></div>
        <div class="sheet-key">Permanent Wounds Suffered</div>
            {{#rollTotal() Severity 1}}
            <div class="sheet-value"><span>You spine is broken at the neck (DEX reduced to 3, cannot move, fight, use items, or cast spells, save v. Death each month or die from complications).</span></div>
            {{/rollTotal() Severity 1}}
            {{#rollTotal() Severity 2}}
            <div class="sheet-value"><span>You spine is broken at the waist (as per legs severed, cannot reproduce, and must save v. Death each year or die from complications).</span></div>
            {{/rollTotal() Severity 2}}
            {{#rollTotal() Severity 3}}
            <div class="sheet-value"><span>Both your arms are severed or crushed (cannot climb, use weapons or items, open locks, remove traps, or any other similar actions).</span></div>
            {{/rollTotal() Severity 3}}
            {{#rollTotal() Severity 4}}
            <div class="sheet-value"><span>Both your legs are severed or crushed (DEX reduced to 3 for AC purposes, two crutches required,  movement reduced by 60', cannot force march).</span></div>
            {{/rollTotal() Severity 4}}
            {{#rollTotal() Severity 5}}
            <div class="sheet-value"><span>You are blinded (-4 to all attack throws, no line of sight for spells, movement reduced to 1/4 normal, -2 to surprise rolls).</span></div>
            {{/rollTotal() Severity 5}}
            {{#rollTotal() Severity 6}}
            <div class="sheet-value"><span>Your lips and tongue are severed or mangled (cannot speak, cast spells or use magic items involving speech, -4 to reaction rolls).</span></div>
            {{/rollTotal() Severity 6}}
        {{/rollBetween() Roll 1 5}}
        {{#rollBetween() Roll -5 0}}
        <div class="sheet-value"><span>You were instantly killed.</span></div>
        <div class="sheet-key">Permanent Wounds Suffered</div>
            {{#rollTotal() Severity 1}}
            <div class="sheet-value"><span>A red stain and shards of bone are all that remain.</span></div>
            {{/rollTotal() Severity 1}}
            {{#rollTotal() Severity 2}}
            <div class="sheet-value"><span>The bloody mess that was once your body is dimly recognizable.</span></div>
            {{/rollTotal() Severity 2}}
            {{#rollTotal() Severity 3}}
            <div class="sheet-value"><span>That's a bad way to go. What's left of you isn't pretty.</span></div>
            {{/rollTotal() Severity 3}}
            {{#rollTotal() Severity 4}}
            <div class="sheet-value"><span>Mangled bones and broken flesh betray your grisly end.</span></div>
            {{/rollTotal() Severity 4}}
            {{#rollTotal() Severity 5}}
            <div class="sheet-value"><span>A ghastly wound reveals your harsh demise.</span></div>
            {{/rollTotal() Severity 5}}
            {{#rollTotal() Severity 6}}
            <div class="sheet-value"><span>Your corpse is largely intact and ready for a noble funeral.</span></div>
            {{/rollTotal() Severity 6}}
        {{/rollBetween() Roll -5 0}}
        {{#rollLess() Roll -5}}
        <div class="sheet-value"><span>You were instantly killed.</span></div>
        <div class="sheet-key">Permanent Wounds Suffered</div>
            {{#rollTotal() Severity 1}}
            <div class="sheet-value"><span>Not even the vultures could feed on you.</span></div>
            {{/rollTotal() Severity 1}}
            {{#rollTotal() Severity 2}}
            <div class="sheet-value"><span>A red stain and shards of bone are all that remain.</span></div>
            {{/rollTotal() Severity 2}}
            {{#rollTotal() Severity 3}}
            <div class="sheet-value"><span>The bloody mess that was once your body is dimly recognizable.</span></div>
            {{/rollTotal() Severity 3}}
            {{#rollTotal() Severity 4}}
            <div class="sheet-value"><span>That's a bad way to go. What's left of you isn't pretty.</span></div>
            {{/rollTotal() Severity 4}}
            {{#rollTotal() Severity 5}}
            <div class="sheet-value"><span>Mangled bones and broken flesh betray your grisly end.</span></div>
            {{/rollTotal() Severity 5}}
            {{#rollTotal() Severity 6}}
            <div class="sheet-value"><span>A ghastly wound reveals your harsh demise.</span></div>
            {{/rollTotal() Severity 6}}
        {{/rollLess() Roll -5}}
      </div>
    </div>
</rolltemplate>

<rolltemplate class="sheet-rolltemplate-critchar">
    <div class="sheet-container sheet-color-{{color}}">
      <div class="sheet-header">
        {{#title}}<div class="sheet-title">{{title}}</div>{{/title}}
        {{#subtitle}}<div class="sheet-subtitle">{{subtitle}}</div>{{/subtitle}}
      </div>
      <div class="sheet-content">
        {{#allprops() title subtitle color}}
        <div class="sheet-key">{{key}}</div>
        <div class="sheet-value">{{value}}</div>
        {{/allprops() title subtitle color}}

        <div class="sheet-key">Result</div>
        {{#rollTotal() Roll 1}}
        <div class="sheet-value"><span><strong>Brawling</strong> - The target suffers an additional 1d4 damage from a strike from the attacker’s gauntlet, pommel, or shield rim. If the attacker has no metal weapons, the damage is nonlethal, but otherwise the brawling damage can be lethal or nonlethal, at his discretion.</span></div>
        {{/rollTotal() Roll 1}}
        {{#rollTotal() Roll 2}}
        <div class="sheet-value"><span><strong>Damage Shield</strong> - The target’s shield is damaged, reducing its effectiveness by 1. If the shield is non-magical, this will destroy it. Damaged shields can be repaired at a cost of 10gp per point of effectiveness. Magic shields cannot be damaged except by magic weapons or monsters of 5 HD or more.</span></div>
        {{/rollTotal() Roll 2}}
        {{#rollTotal() Roll 3}}
        <div class="sheet-value"><span><strong>Damage Armor</strong> - The target’s armor is damaged, reducing its effectiveness by 1 point. Armor that loses all effectiveness is ruined. Damaged armor can be repaired at a cost of 10gp per point of effectiveness. Magic armor cannot be damaged except by magic weapons or monsters of 5 HD or more.</span></div>
        {{/rollTotal() Roll 3}}
        {{#rollTotal() Roll 4}}
        <div class="sheet-value"><span><strong>Disarm</strong> - The target is disarmed of its weapon (as the special maneuver). The weapon drops to a point chosen by the attacker who dealt the critical hit, up to 5’ distant from the target.</span></div>
        {{/rollTotal() Roll 4}}
        {{#rollTotal() Roll 5}}
        <div class="sheet-value"><span><strong>Force Back</strong> - The target is forced back (as the special maneuver). It must withdraw a number of feet equal to the attacker’s damage roll. If this would push the opponent into a wall or obstacle, the opponent is knocked down, and takes 1d6 points of damage per 10’ he has traveled.</span></div>
        {{/rollTotal() Roll 5}}
        {{#rollTotal() Roll 6}}
        <div class="sheet-value"><span><strong>Knockdown</strong> - The target is immediately knocked down (as the special maneuver). Once prone, the creature can move, but only to crawl at a movement rate of 5’, to take an action in lieu of moving, or to end the condition by using an action in lieu of moving to stand up. If engaged, the prone creature remains subject to the movement restrictions of being engaged, so it can only crawl if using defensive movement, and cannot stand up in lieu of moving. The prone creature can attack, but suffers a -4 penalty on its attack throws. Alternatively the prone creature can stand up in lieu of attacking. The prone creature can be backstabbed by creatures capable of doing so. Attack throws against the prone creatures gain a +2 bonus, or a +4 bonus if the attacker backstabs the stunned creature. The conditions is ended immediately when the creature stands up.</span></div>
        {{/rollTotal() Roll 6}}
        {{#rollTotal() Roll 7}}
        <div class="sheet-value"><span><strong>Sunder Weapon</strong> - The target’s weapon is sundered (as the special maneuver). If the target’s weapon is a non-magical spear, staff, or pole arm, it shatters into splinters when sundered, dealing an additional 1d4 nonlethal damage to the target. Swords cannot be sundered by non-metal weapons or natural attacks by creatures of less than 5 HD. Magic weapons cannot be sundered except by other magic weapons or monsters of 5 HD or more.</span></div>
        {{/rollTotal() Roll 7}}
        {{#rollTotal() Roll 8}}
        <div class="sheet-value"><span><strong>Stun</strong> - The target is stunned until the end of its next initiative. A stunned creature cannot attack, cast spells, or move. It gains no benefit to its AC from its shield (if any), and can be ambushed or backstabbed by creatures capable of doing so. All attack throws against stunned creatures gain a +2 bonus, or a +4 bonus if the attacker ambushes or backstabs the stunned creature.</span></div>
        {{/rollTotal() Roll 8}}
        {{#rollTotal() Roll 9}}
        <div class="sheet-value"><span><strong>Wrestle/Clamber</strong> - The results of this critical effect depend on the difference in size between the attacker and target. If the target is the same size category or smaller than the attacker, the attacker has grabbed the target in a wrestling hold (as the special maneuver). If the target is one or more size categories larger than the attacker, the attacker has clambered on top of or mounted the target (as the special maneuver).</span></div>
        {{/rollTotal() Roll 9}}
        {{#rollTotal() Roll 10}}
        <div class="sheet-value"><span><strong>Attacker's Choice</strong> - The attacker may choose any desired critical effect (Brawling, Damage Shield, Damage Armor, Disarm, Force Back, Knockdown, Sunder Weapon, Stun, Wrestle/Clamber).</span></div>
        {{/rollTotal() Roll 10}}
      </div>
    </div>
</rolltemplate>

<rolltemplate class="sheet-rolltemplate-critmon">
    <div class="sheet-container sheet-color-{{color}}">
      <div class="sheet-header">
        {{#title}}<div class="sheet-title">{{title}}</div>{{/title}}
        {{#subtitle}}<div class="sheet-subtitle">{{subtitle}}</div>{{/subtitle}}
      </div>
      <div class="sheet-content">
        {{#allprops() title subtitle color}}
        <div class="sheet-key">{{key}}</div>
        <div class="sheet-value">{{value}}</div>
        {{/allprops() title subtitle color}}

        <div class="sheet-key">Result</div>
        {{#rollTotal() Roll 1}}
        <div class="sheet-value"><span><strong>Brawling</strong> - The target suffers an additional 1d4 damage from a strike from the attacker’s gauntlet, pommel, or shield rim. If the attacker has no metal weapons, the damage is nonlethal, but otherwise the brawling damage can be lethal or nonlethal, at his discretion.</span></div>
        {{/rollTotal() Roll 1}}
        {{#rollTotal() Roll 2}}
        <div class="sheet-value"><span><strong>Fatigued</strong> - The target is wearied by the flurry of blows. The target suffers a -1 penalty to attack throws and damage throws until it rests. If additional fatigue effects are rolled, the effects are cumulative.</span></div>
        {{/rollTotal() Roll 2}}
        {{#rollTotal() Roll 3}}
        <div class="sheet-value"><span><strong>Injure Hide</strong> - The target’s hide is bruised, cut, or broken open such that its AC is reduced by 1 until it rests.</span></div>
        {{/rollTotal() Roll 3}}
        {{#rollTotal() Roll 4}}
        <div class="sheet-value"><span><strong>Impair Move</strong> - The movement rate of the target’s primary movement is reduced by 25% or 30’ (whichever is less) until the target rests. This represents a leg being wrenched, an ankle twisted, and so on.</span></div>
        {{/rollTotal() Roll 4}}
        {{#rollTotal() Roll 5}}
        <div class="sheet-value"><span><strong>Force Back</strong> - The target is forced back (as the special maneuver). It must withdraw a number of feet equal to the attacker’s damage roll. If this would push the opponent into a wall or obstacle, the opponent is knocked down, and takes 1d6 points of damage per 10’ he has traveled.</span></div>
        {{/rollTotal() Roll 5}}
        {{#rollTotal() Roll 6}}
        <div class="sheet-value"><span><strong>Knockdown</strong> - The target is immediately knocked down (as the special maneuver). Once prone, the creature can move, but only to crawl at a movement rate of 5’, to take an action in lieu of moving, or to end the condition by using an action in lieu of moving to stand up. If engaged, the prone creature remains subject to the movement restrictions of being engaged, so it can only crawl if using defensive movement, and cannot stand up in lieu of moving. The prone creature can attack, but suffers a -4 penalty on its attack throws. Alternatively the prone creature can stand up in lieu of attacking. The prone creature can be backstabbed by creatures capable of doing so. Attack throws against the prone creatures gain a +2 bonus, or a +4 bonus if the attacker backstabs the stunned creature. The conditions is ended immediately when the creature stands up.</span></div>
        {{/rollTotal() Roll 6}}
        {{#rollTotal() Roll 7}}
        <div class="sheet-value"><span><strong>Impair Attack</strong> - One of the target’s natural attacks (determined randomly) is somehow impaired – muscles sprained, claws ripped, etc. The target suffers a -4 to attack throws with the impaired natural attack until it rests.</span></div>
        {{/rollTotal() Roll 7}}
        {{#rollTotal() Roll 8}}
        <div class="sheet-value"><span><strong>Stun</strong> - The target is stunned until the end of its next initiative. A stunned creature cannot attack, cast spells, or move. It gains no benefit to its AC from its shield (if any), and can be ambushed or backstabbed by creatures capable of doing so. All attack throws against stunned creatures gain a +2 bonus, or a +4 bonus if the attacker ambushes or backstabs the stunned creature.</span></div>
        {{/rollTotal() Roll 8}}
        {{#rollTotal() Roll 9}}
        <div class="sheet-value"><span><strong>Wrestle/Clamber</strong> - The results of this critical effect depend on the difference in size between the attacker and target. If the target is the same size category or smaller than the attacker, the attacker has grabbed the target in a wrestling hold (as the special maneuver). If the target is one or more size categories larger than the attacker, the attacker has clambered on top of or mounted the target (as the special maneuver).</span></div>
        {{/rollTotal() Roll 9}}
        {{#rollTotal() Roll 10}}
        <div class="sheet-value"><span><strong>Attacker's Choice</strong> - The attacker may choose any desired critical effect (Brawling, Fatigued, Injure Hide, Impair Attack, Force Back, Knockdown, Impair Attack, Stun, Wrestle/Clamber).</span></div>
        {{/rollTotal() Roll 10}}
      </div>
    </div>
</rolltemplate>